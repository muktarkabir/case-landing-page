/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={56:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},72:t=>{var e=[];function n(t){for(var n=-1,r=0;r<e.length;r++)if(e[r].identifier===t){n=r;break}return n}function r(t,r){for(var s={},o=[],a=0;a<t.length;a++){var c=t[a],u=r.base?c[0]+r.base:c[0],l=s[u]||0,h="".concat(u," ").concat(l);s[u]=l+1;var d=n(h),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)e[d].references++,e[d].updater(f);else{var m=i(f,r);r.byIndex=a,e.splice(a,0,{identifier:h,updater:m,references:1})}o.push(h)}return o}function i(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,i){var s=r(t=t||[],i=i||{});return function(t){t=t||[];for(var o=0;o<s.length;o++){var a=n(s[o]);e[a].references--}for(var c=r(t,i),u=0;u<s.length;u++){var l=n(s[u]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}s=c}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},248:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(919),c=o()(i());c.i(a.A),c.push([t.id,"/* Section spacing */\n.impact-section {\n  padding: 4rem 1rem;\n}\n\n.impact-section.dark {\n  background-color: #1a1a1a;\n  color: #ddd;\n}\n\n/* Container */\n.container {\n  max-width: 1100px;\n  margin: 0 auto;\n}\n\n/* Header */\n.section-header {\n  text-align: center;\n  max-width: 700px;\n  margin: 0 auto 3rem;\n}\n\n.section-header h2 {\n  font-size: 2rem;\n  font-weight: bold;\n  margin-bottom: 0.5rem;\n  color: #222;\n}\n\n.impact-section.dark .section-header h2 {\n  color: #fff;\n}\n\n.section-header p {\n  color: #555;\n  font-size: 1rem;\n}\n\n.impact-section.dark .section-header p {\n  color: #aaa;\n}\n\n/* Grid layout */\n.impact-grid {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1.5rem;\n  text-align: center;\n}\n\n@media (min-width: 768px) {\n  .impact-grid {\n    grid-template-columns: repeat(4, 1fr);\n  }\n}\n\n/* Cards */\n.impact-card {\n  background-color: #f9f9f9;\n  padding: 2rem 1rem;\n  border-radius: 0.75rem;\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\n}\n\n.impact-section.dark .impact-card {\n  background-color: #2a2a2a;\n}\n\n.impact-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.15);\n}\n\n.impact-number {\n  font-size: 2rem;\n  font-weight: bold;\n  color: var(--main-color);\n  margin-bottom: 0.5rem;\n}\n\n.impact-card p {\n  font-weight: 600;\n  color: #222;\n  font-size: 0.95rem;\n}\n\n.impact-section.dark .impact-card p {\n  color: #eee;\n}\n\n/* Note */\n.impact-note {\n  text-align: center;\n  margin-top: 2rem;\n  font-size: 0.85rem;\n  color: #777;\n}\n\n.impact-section.dark .impact-note {\n  color: #bbb;\n}\n",""]);const u=c},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,r,i,s){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var u=0;u<t.length;u++){var l=[].concat(t[u]);r&&o[l[0]]||(void 0!==s&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=s),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),e.push(l))}},e}},426:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(919),c=o()(i());c.i(a.A),c.push([t.id,"/* Section background */\n.gallery-section {\n  background-color: #F1F5F9;\n  padding: 4rem 1rem;\n}\n\n.gallery-section.dark {\n  background-color: #1a1a1a;\n  color: #ddd;\n}\n\n/* Container */\n.container {\n  max-width: 1100px;\n  margin: 0 auto;\n}\n\n/* Heading */\n.section-header {\n  text-align: center;\n  margin-bottom: 3rem;\n}\n\n.section-header h2 {\n  font-size: 2rem;\n  font-weight: bold;\n  color: #222;\n}\n\n.gallery-section.dark .section-header h2 {\n  color: #fff;\n}\n\n/* Grid */\n.gallery-grid {\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 2rem;\n}\n\n@media (min-width: 768px) {\n  .gallery-grid {\n    grid-template-columns: repeat(3, 1fr);\n  }\n}\n\n/* Items */\n.gallery-item {\n  text-align: center;\n  transition: transform 0.3s ease;\n}\n\n.gallery-item img {\n  width: 100%;\n  height: 16rem;\n  object-fit: cover;\n  border-radius: 0.5rem;\n  box-shadow: 0 4px 10px rgba(0,0,0,0.1);\n  transition: transform 0.4s ease;\n}\n\n.gallery-item:hover img {\n  transform: scale(1.05);\n}\n\n.gallery-item p {\n  margin-top: 0.5rem;\n  font-size: 0.9rem;\n  color: #555;\n}\n\n.gallery-section.dark .gallery-item p {\n  color: #aaa;\n}\n\n/* Note */\n.gallery-note {\n  text-align: center;\n  margin-top: 2rem;\n  font-size: 0.85rem;\n  color: #777;\n}\n\n.gallery-section.dark .gallery-note {\n  color: #bbb;\n}",""]);const u=c},430:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),i=n.n(r),s=n(314),o=n.n(s)()(i());o.push([t.id,"/*\n  Josh's Custom CSS Reset\n  https://www.joshwcomeau.com/css/custom-css-reset/\n*/\n\n*,\n*::before,\n*::after {\n  box-sizing: border-box;\n}\n\n* {\n  margin: 0;\n  padding: 0;\n}\n\n@media (prefers-reduced-motion: no-preference) {\n  html {\n    interpolate-size: allow-keywords;\n  }\n}\n\nbody {\n  line-height: 1.5;\n  -webkit-font-smoothing: antialiased;\n}\n\nimg,\npicture,\nvideo,\ncanvas,\nsvg {\n  display: block;\n  max-width: 100%;\n}\n\ninput,\nbutton,\ntextarea,\nselect {\n  font: inherit;\n}\n\np,\nh1,\nh2,\nh3,\nh4,\nh5,\nh6 {\n  overflow-wrap: break-word;\n}\n\np {\n  text-wrap: pretty;\n}\nh1,\nh2,\nh3,\nh4,\nh5,\nh6 {\n  text-wrap: balance;\n}\n\n#root,\n#__next {\n  isolation: isolate;\n}\n",""]);const a=o},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},555:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(919),c=o()(i());c.i(a.A),c.push([t.id,"/* ===== About Section ===== */\n#about {\n  padding: 1rem 0; /* py-16 */\n}\n\n@media (min-width: 768px) {\n  #about {\n    padding: 6rem 0; /* md:py-24 */\n  }\n}\n\n#about .container {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 0 1.5rem; /* px-6 */\n}\n\n/* Section header */\n#about h2 {\n  font-size: 2.6rem; /* text-3xl */\n  margin-bottom: 1rem;\n  font-weight: 700;\n  color:  #111827;\n  text-align: center;\n}\n\n@media (min-width: 768px) {\n  #about h2 {\n    font-size: 3rem; /* md:text-4xl */\n  }\n}\n\n#about p {\n  color: #475569; /* slate-600 */\n}\n\n.dark #about h2 {\n  color: #ffffff;\n}\n\n.dark #about p {\n  color: #94a3b8; /* slate-400 */\n}\n\n#about .section-intro {\n  max-width: 48rem; /* max-w-3xl */\n  margin: 0 auto 3rem;\n  text-align: center;\n}\n\n/* Features grid */\n#about .features {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr); /* grid-cols-2 */\n  gap: 1.5rem; /* gap-6 */\n  text-align: center;\n}\n.feature p {\n  text-align: center;\n}\n\n@media (min-width: 768px) {\n  #about .features {\n    grid-template-columns: repeat(3, 1fr); /* md:grid-cols-3 */\n  }\n}\n\n@media (min-width: 1024px) {\n  #about .features {\n    grid-template-columns: repeat(5, 1fr); /* lg:grid-cols-5 */\n  }\n}\n\n/* Feature card */\n#about .feature {\n  background: #F1F5F9;\n  padding: 1.5rem;\n  border-radius: 0.75rem; /* rounded-lg */\n}\n\n\n#about .feature p {\n  font-weight: 600;\n  color: var(--text-dark, #111827);\n  text-align: center;\n}\n\n",""]);const u=c},601:t=>{t.exports=function(t){return t[1]}},653:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(919),c=o()(i());c.i(a.A),c.push([t.id,'section.waitlist-section {\n    text-align: center;\n    padding: 2rem 1rem;\n    background: #F1F5F9;\n    width: 100%;\n    /* margin: 3rem auto; */\n    display: grid;\n    place-items: center;\n    min-height: 500px;\n}\n\n.waitlist-content{\n    max-width: 600px;\n}\n.waitlist-title {\n  font-family: "Source Serif Pro", serif;\n  font-size: 2.2rem;\n  font-weight: 700;\n  color: #222;\n  margin-bottom: 0.5rem;\n  color: #333;\n}\n\n.waitlist-subtitle {\n  font-family: "Inter", sans-serif;\n  font-size: 1.05rem;\n  font-weight: 400;\n  color: #555;\n  margin-bottom: 2rem;\n  color: #666;\n}\n\n\nform.waitlist-form {\n  display: flex;\n  gap: 0.5rem;\n  justify-content: center;\n  align-items: start;\n  flex-wrap: wrap;\n}\n\n.input-group{\n  flex: 1;\n  min-width: 300px;\n  display: flex;\n  flex-direction: column;\n  align-items: start;\n}\n#email-feedback{\n  font-size: 0.8rem;\n  font-style: italic;\n  color: red;\n}\n\n.waitlist-form input {\n  width: 100%;\n  padding: 0.9rem 1rem;\n  border: 2px solid #eee;\n  border-radius: 12px;\n  font-size: 1rem;\n  outline: none;\n  transition: border 0.3s;\n}\n\n.waitlist-form input:focus {\n  border-color: #ebbc80;\n}\n\n.waitlist-form button {\n  background: #ebbc80;\n  border: none;\n  height: 54px;\n  width: 121px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 6px;\n  font-size: 1rem;\n  font-weight: 600;\n  color: #fff;\n  cursor: pointer;\n  transition:\n    background 0.3s,\n    transform 0.2s;\n\n\n  /* smooth transition */\n  transition:\n    transform 0.15s ease,\n    filter 0.15s ease,\n    box-shadow 0.15s ease;\n}\n\n.waitlist-form button:hover {\n  filter: brightness(1.05); /* subtle glow effect */\n  transform: translateY(-2px); /* tiny lift on hover */\n}\n\n.waitlist-note {\n  margin-top: 1.5rem;\n  color: #444;\n  font-size: 0.95rem;\n  span{\n    color: #ebbc80;\n  }\n}\n\n.success {\n  margin-top: 1rem;\n  padding: 0.8rem;\n  background: #d4f5d4;\n  border-radius: 0.5rem;\n  color: #0a662e;\n  font-weight: 500;\n  display: none; /* shown with JS later */\n}\n\n.error{\n      margin-top: 1rem;\n  padding: 0.8rem;\n  background: #f8a6a6;\n  border-radius: 0.5rem;\n  color: #66100a;\n  font-weight: 500;\n  display: none; \n}',""]);const u=c},659:t=>{var e={};t.exports=function(t,n){var r=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},678:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(919),c=o()(i());c.i(a.A),c.push([t.id,"/* Section layout */\n.mission {\n  padding: 4rem 1rem;\n  background: #fff;\n  font-family: sans-serif;\n}\n\n.mission .container {\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 2.5rem;\n  max-width: 1100px;\n  margin: 0 auto;\n  align-items: center;\n}\n\n@media (min-width: 768px) {\n  .mission .container {\n    grid-template-columns: 1fr 1fr;\n  }\n}\n\n/* Text */\n.mission h2 {\n  font-size: 2rem;\n  margin-bottom: 1rem;\n  color: #111827;\n}\n\n.mission p {\n  color: #4b5563;\n  margin-bottom: 1.5rem;\n  line-height: 1.6;\n}\n\n/* List */\n.mission-list {\n  list-style: none;\n  padding: 0;\n  margin: 0;\n}\n\n.mission-list li {\n  display: flex;\n  align-items: flex-start;\n  margin-bottom: 1rem;\n  font-size: 0.95rem;\n  color: #374151;\n}\n\n.mission-list .check {\n  color: var(--main-color);\n  font-weight: bold;\n  margin-right: 0.75rem;\n  font-size: 1.1rem;\n  flex-shrink: 0;\n}\n\n/* Image */\n.image-wrapper img {\n  width: 100%;\n  height: auto;\n  border-radius: 0.75rem;\n  box-shadow: 0 10px 20px rgba(0,0,0,0.1);\n  object-fit: cover;\n}\n",""]);const u=c},679:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(919),c=o()(i());c.i(a.A),c.push([t.id,"/* Layout */\n.how-it-works {\n    background: #F1F5F9;\n\n  padding: 4rem 1rem;\n  text-align: center;\n  font-family: sans-serif;\n}\n\n.how-it-works .container {\n  max-width: 1000px;\n  margin: 0 auto;\n}\n\n.section-header h2 {\n  font-size: 2rem;\n  margin-bottom: 2rem;\n  color: #111827;\n}\n\n/* Steps */\n.steps {\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 2rem;\n}\n\n@media (min-width: 768px) {\n  .steps {\n    grid-template-columns: repeat(3, 1fr);\n  }\n}\n\n.step h3 {\n  font-size: 1.25rem;\n  margin: 0.5rem 0;\n  color: #111827;\n}\n\n.step p {\n  color: #4b5563;\n  font-size: 0.95rem;\n}\n\n.circle {\n  background: var(--main-color);\n  color: #fff;\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 0 auto 1rem;\n  font-weight: bold;\n  font-size: 1.2rem;\n  box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n}\n\n/* Examples */\n.examples {\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 1.5rem;\n  margin-top: 3rem;\n}\n\n@media (min-width: 768px) {\n  .examples {\n    grid-template-columns: 1fr 1fr;\n  }\n}\n\n.card {\n  background: #fff;\n  padding: 1.5rem;\n  border-radius: 0.75rem;\n  box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n  text-align: left;\n}\n\n.card h4 {\n  font-size: 1.1rem;\n  margin-bottom: 0.5rem;\n  color: #111827;\n}\n\n.card pre {\n  background: #f3f4f6;\n  padding: 1rem;\n  border-radius: 0.5rem;\n  font-size: 0.9rem;\n  white-space: pre-wrap;\n  color: #374151;\n}\n\n/* Note */\n.note {\n  margin-top: 2rem;\n  font-size: 0.85rem;\n  color: #6b7280;\n}",""]);const u=c},730:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(919),c=o()(i());c.i(a.A),c.push([t.id,"/* ===== HERO SECTION ===== */\n#hero {\n  background-color: #F8FAFC;\n  padding: 3rem 1.5rem;\n}\n@media (min-width: 768px) {\n  #hero {\n    padding: 6rem 1.5rem;\n  }\n}\n\n#hero .container {\n  max-width: 1200px;\n  margin: 0 auto;\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 3rem;\n  align-items: center;\n}\n@media (min-width: 768px) {\n  #hero .container {\n    grid-template-columns: 1fr 1fr;\n  }\n}\n\n/* Left Column */\n#hero-headline {\n  font-size: 2.5rem;\n  line-height: 1.2;\n  margin-bottom: 1rem;\n}\n@media (min-width: 768px) {\n  #hero-headline {\n    font-size: 3rem;\n  }\n}\n\n#hero-subheadline {\n  font-size: 1.125rem;\n  color: #475569; /* slate-600 */\n  margin-bottom: 2rem;\n}\n\n/* Buttons */\n#hero .buttons {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n@media (min-width: 640px) {\n  #hero .buttons {\n    flex-direction: row;\n  }\n}\n\n#hero .btn-primary {\n  text-decoration: none;\n  background-color: var(--main-color);\n  color: white;\n  padding: 0.75rem 1.5rem;\n  border-radius: 0.5rem;\n  font-weight: 600;\n  text-align: center;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  transition: transform 0.2s, background-color 0.2s;\n}\n#hero .btn-primary:hover {\n  transform: scale(1.05);\n}\n\n#hero .btn-outline {\n  text-decoration: none;\n  border: 2px solid var(--main-color);\n  color: var(--main-color);\n  padding: 0.75rem 1.5rem;\n  border-radius: 0.5rem;\n  font-weight: 600;\n  text-align: center;\n  transition: background-color 0.2s;\n}\n#hero .btn-outline:hover {\n  background: rgba(235, 188, 128,0.15);\n\n}\n\n/* Features list */\n#hero .features {\n  margin-bottom: 1.5rem;\n}\n#hero .features p {\n  font-size: 0.9rem;\n  color: #6b7280; /* slate-500 */\n  margin-bottom: 0.5rem;\n}\n\n#hero .priority-note {\n  font-size: 0.75rem;\n  color: #6b7280;\n}\n\n/* Right Column (Image) */\n#hero img {\n  width: 100%;\n  height: auto;\n  border-radius: 0.75rem;\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);\n}\n\n\n/* ===== Fade In Up Animation ===== */\n@keyframes fadeInUp {\n  0% {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.animate-fade-in-up {\n  opacity: 0;\n  animation: fadeInUp 0.8s ease-out forwards;\n}\n\n/* Add optional staggered delays if you want */\n.animate-delay-200 {\n  animation-delay: 0.2s;\n}\n.animate-delay-400 {\n  animation-delay: 0.4s;\n}\n",""]);const u=c},762:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(919),c=o()(i());c.i(a.A),c.push([t.id,'/* Base layout */\n.testimonials {\n  padding: 4rem 1rem;\n  background: #f9fafb;\n}\n\n.testimonials h2 {\n  text-align: center;\n  font-size: 2rem;\n  margin-bottom: 2rem;\n  position: relative;\n}\n\n.testimonials h2::after {\n  content: "";\n  display: block;\n  width: 80px;\n  height: 3px;\n  background: var(--main-color); /* accent line */\n  margin: 0.75rem auto 0;\n  border-radius: 2px;\n}\n\n/* Grid */\n.testimonials .grid {\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 1.5rem;\n  max-width: 1000px;\n  margin: 0 auto;\n}\n\n@media (min-width: 768px) {\n  .testimonials .grid {\n    grid-template-columns: repeat(3, 1fr);\n  }\n}\n\n/* Card */\n.grid.card {\n  background: white;\n  padding: 1.5rem;\n  border-radius: 12px;\n  box-shadow: 0 4px 10px rgba(0,0,0,0.05);\n  opacity: 0;\n  transform: translateY(20px);\n  transition: transform 2.8s ease ;\n}\n\n\n.card:hover {\n  transform: translateY(-6px);\n  box-shadow: 0 8px 20px rgba(0,0,0,0.1);\n}\n\n/* Text */\n.quote {\n  font-style: italic;\n  color: #4b5563;\n  margin-bottom: 1rem;\n}\n\n.author {\n  font-weight: bold;\n  color: #111827;\n}',""]);const u=c},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},848:(t,e,n)=>{n.d(e,{A:()=>u});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(919),c=o()(i());c.i(a.A),c.push([t.id,'/* Layout */\n.faq {\n  padding: 4rem 1rem;\n  background: #f9fafb;\n}\n\n.faq .container {\n  max-width: 800px;\n  margin: 0 auto;\n}\n\n.faq h2 {\n  text-align: center;\n  font-size: 2rem;\n  margin-bottom: 2rem;\n}\n\n/* Accordion */\n.faq details {\n  border-bottom: 1px solid #e5e7eb;\n  padding: 1rem 0;\n}\n\n.faq summary {\n  cursor: pointer;\n  font-weight: 600;\n  font-size: 1.125rem;\n  color: #111827;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.faq summary::after {\n  content: "+";\n  font-size: 1.5rem;\n  color: var(--main-color);\n  transition: transform 0.3s ease;\n}\n\n.faq details[open] summary::after {\n  content: "−";\n  transform: rotate(180deg);\n}\n\n.faq p {\n  margin-top: 0.75rem;\n  color: #4b5563;\n  line-height: 1.5;\n  font-size: 0.95rem;\n}\n\n/* Hover effect */\n.faq summary:hover {\n  color: var(--main-color);\n}\n\n',""]);const u=c},919:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),i=n.n(r),s=n(314),o=n.n(s)()(i());o.push([t.id,"@import url(https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@400;600;700&family=Inter:wght@400;500;600&display=swap);"]),o.push([t.id,'/* Source Serif Pro (400, 600, 700) + Inter (400, 500, 600) */\n\n:root {\n  --main-color: #ebbc80;\n}\nh1,\nh2,\nh3,\nh4,\nh5,\nh6 {\n  font-family: "Source Serif Pro", serif;\n}\n\nbody {\n  font-family: "Inter", sans-serif;\n  font-size: 16px;\n  line-height: 1.6;\n  color: #333;\n}\n\n.spinner {\n  animation: spin 0.6s linear infinite;\n}\n\n@keyframes spin {\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n/* ===== Header Base ===== */\n#header {\n  background-color: rgba(255, 255, 255, 0.8);\n  backdrop-filter: blur(6px);\n  position: sticky;\n  top: 0;\n  z-index: 50;\n  transition: background-color 0.3s ease;\n}\n\n/* ===== Container ===== */\n#header .container {\n  width: 100%;\n  margin: 0 auto;\n  padding: .8rem 1rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n/* ===== Logo ===== */\n#header a.text-logo {\n  font-size: 1.5rem; /* text-2xl */\n  font-weight: 700;\n  font-family: "Source Serif Pro", serif;\n  color: #111827; /* text-dark */\n  text-decoration: none;\n}\n\n/* ===== Navigation ===== */\n#header nav {\n  display: none;\n}\n\n@media (min-width: 768px) {\n  #header nav {\n    display: flex;\n    align-items: center;\n    gap: 2rem;\n  }\n}\n\n#header nav a {\n  color: #111827;\n  text-decoration: none;\n  transition: color 0.3s ease;\n}\n\nbody.dark #header nav a {\n  color: #d1d5db; /* gray-300 */\n}\n\n/* Join Waitlist Button */\n#header nav a.join-btn {\n  background-color: var(--main-color); /* primary */\n  color: #fff;\n  padding: 0.5rem 1rem;\n  border-radius: 0.375rem;\n  font-weight: 500;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);\n  transition: all 0.3s ease;\n}\n\n#header nav a.join-btn:hover {\n  filter: brightness(1.05); /* subtle glow effect */\n  transform: translateY(-2px); /* tiny lift on hover */\n  \n}\n\n.logo-container {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.logo-text {\n  flex: 1;\n}\n\n\n/* ===== Mobile Menu Button ===== */\n#mobile-menu-button {\n  background: none;\n  border: none;\n  cursor: pointer;\n  color: #111827;\n}\n\nbody.dark #mobile-menu-button {\n  color: #fff;\n}\n\n/* ===== Mobile Menu ===== */\n#mobile-menu {\n  display: none;\n  padding: 0 1.5rem 1rem;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n#mobile-menu a {\n  color: #111827;\n  text-decoration: none;\n  transition: color 0.3s ease;\n}\n\nbody.dark #mobile-menu a {\n  color: #d1d5db;\n}\n\n#mobile-menu a.join-btn {\n  background-color: var(--main-color);\n  color: #fff;\n  padding: 0.5rem 1rem;\n  border-radius: 0.375rem;\n  font-weight: 500;\n  text-align: center;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);\n  transition: all 0.3s ease;\n}\n\n#mobile-menu a.join-btn:hover {\n  background-color: var(--main-color);\n}\n\n/* ===== Utility ===== */\n\n/* hide by default */\n#mobile-menu {\n  display: none;\n}\n\n/* when active, show (stacking as column) */\n#mobile-menu.active {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n/* ensure desktop nav still shows (example) */\n@media (min-width: 768px) {\n  #header nav {\n    display: flex;\n  }\n  #mobile-menu {\n    display: none !important;\n  } /* keep it hidden on desktop */\n  #mobile-menu-button {\n    display: none;\n  }\n}\n\n\n\n/* Footer Base */\n.footer {\n  background: #111827; /* dark background */\n  color: #d1d5db; /* gray-300 */\n  padding: 3rem 1rem;\n  text-align: center;\n  a{\n    text-decoration: none;\n  }\n}\n\n.footer .container {\n  max-width: 900px;\n  margin: 0 auto;\n}\n\n/* Contact */\n.footer .contact {\n  margin-bottom: 1.5rem;\n}\n\n.footer .contact .heading {\n  font-weight: 600;\n  margin-bottom: 0.25rem;\n}\n\n.footer .contact a {\n  color: var(--main-color); /* primary */\n  text-decoration: none;\n  transition: color 0.3s ease;\n}\n\n.footer .contact a:hover {\n  text-decoration: underline;\n  color: var(--main-color); /* accent hover */\n}\n\n/* Buttons */\n.footer .actions {\n  display: flex;\n  justify-content: center;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n  flex-wrap: wrap;\n}\n\n.footer .btn-primary {\n  background: var(--main-color);\n  color: #fff;\n  padding: 0.5rem 1rem;\n  border-radius: 0.5rem;\n  font-weight: 500;\n  transition: background 0.3s ease, transform 0.2s ease;\n}\n\n.footer .btn-primary:hover {\n  background: var(--main-color);\n  transform: scale(1.05);\n}\n\n.footer .btn-outline {\n  border: 1px solid var(--main-color);\n  color: var(--main-color);\n  padding: 0.5rem 1rem;\n  border-radius: 0.5rem;\n  font-weight: 500;\n  transition: background 0.3s ease, transform 0.2s ease;\n}\n\n.footer .btn-outline:hover {\n  background: rgba(235, 188, 128,0.15);\n  transform: scale(1.05);\n}\n\n/* Policy */\n.footer .policy {\n  font-size: 0.75rem;\n  color: #9ca3af;\n  margin-bottom: 1rem;\n  line-height: 1.4;\n}\n\n.footer .policy a {\n  text-decoration: underline;\n  color: var(--main-color);\n  transition: color 0.3s ease;\n}\n\n.footer .policy a:hover {\n  color: var(--main-color);\n}\n\n/* Copyright */\n.footer .copy {\n  font-size: 0.875rem;\n  color: #6b7280;\n}\n',""]);const a=o}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={id:r,exports:{}};return t[r](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0;var r=n(72),i=n.n(r),s=n(825),o=n.n(s),a=n(659),c=n.n(a),u=n(56),l=n.n(u),h=n(540),d=n.n(h),f=n(113),m=n.n(f),p=n(430),g={};g.styleTagTransform=m(),g.setAttributes=l(),g.insert=c().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=d(),i()(p.A,g),p.A&&p.A.locals&&p.A.locals;var y=n(919),w={};w.styleTagTransform=m(),w.setAttributes=l(),w.insert=c().bind(null,"head"),w.domAPI=o(),w.insertStyleElement=d(),i()(y.A,w),y.A&&y.A.locals&&y.A.locals;var v=n(653),b={};b.styleTagTransform=m(),b.setAttributes=l(),b.insert=c().bind(null,"head"),b.domAPI=o(),b.insertStyleElement=d(),i()(v.A,b),v.A&&v.A.locals&&v.A.locals;var E=n(730),_={};_.styleTagTransform=m(),_.setAttributes=l(),_.insert=c().bind(null,"head"),_.domAPI=o(),_.insertStyleElement=d(),i()(E.A,_),E.A&&E.A.locals&&E.A.locals;var T=n(555),S={};S.styleTagTransform=m(),S.setAttributes=l(),S.insert=c().bind(null,"head"),S.domAPI=o(),S.insertStyleElement=d(),i()(T.A,S),T.A&&T.A.locals&&T.A.locals;var I=n(679),C={};C.styleTagTransform=m(),C.setAttributes=l(),C.insert=c().bind(null,"head"),C.domAPI=o(),C.insertStyleElement=d(),i()(I.A,C),I.A&&I.A.locals&&I.A.locals;var A=n(678),x={};x.styleTagTransform=m(),x.setAttributes=l(),x.insert=c().bind(null,"head"),x.domAPI=o(),x.insertStyleElement=d(),i()(A.A,x),A.A&&A.A.locals&&A.A.locals;var D=n(426),k={};k.styleTagTransform=m(),k.setAttributes=l(),k.insert=c().bind(null,"head"),k.domAPI=o(),k.insertStyleElement=d(),i()(D.A,k),D.A&&D.A.locals&&D.A.locals;var N=n(248),R={};R.styleTagTransform=m(),R.setAttributes=l(),R.insert=c().bind(null,"head"),R.domAPI=o(),R.insertStyleElement=d(),i()(N.A,R),N.A&&N.A.locals&&N.A.locals;var O=n(762),L={};L.styleTagTransform=m(),L.setAttributes=l(),L.insert=c().bind(null,"head"),L.domAPI=o(),L.insertStyleElement=d(),i()(O.A,L),O.A&&O.A.locals&&O.A.locals;var M=n(848),P={};P.styleTagTransform=m(),P.setAttributes=l(),P.insert=c().bind(null,"head"),P.domAPI=o(),P.insertStyleElement=d(),i()(M.A,P),M.A&&M.A.locals&&M.A.locals;const V=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},F={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(V(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],s=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==s||null==o||null==a)throw new U;const c=i<<2|s>>4;if(r.push(c),64!==o){const t=s<<4&240|o>>2;if(r.push(t),64!==a){const t=o<<6&192|a;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class U extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const B=function(t){return function(t){const e=V(t);return F.encodeByteArray(e,!0)}(t).replace(/\./g,"")};const j=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return F.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},q=()=>j()?.config;class z{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function $(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}const G={};let H=!1;function K(t,e){if("undefined"==typeof window||"undefined"==typeof document||!$(window.location.host)||G[t]===e||G[t]||H)return;function n(t){return`__firebase__banner__${t}`}G[t]=e;const r="__firebase__banner",i=function(){const t={prod:[],emulator:[]};for(const e of Object.keys(G))G[e]?t.emulator.push(e):t.prod.push(e);return t}().prod.length>0;function s(){const t=function(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}(r),e=n("text"),s=document.getElementById(e)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;!function(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}(e),function(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}(a,o);const n=function(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{H=!0,function(){const t=document.getElementById(r);t&&t.remove()}()},t}();!function(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}(u,c),e.append(u,s,a,n),document.body.appendChild(e)}i?(s.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',s.innerText="Preview backend running in this workspace."),s.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function Q(){return!function(){const t=j()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class W extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,W.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,X.prototype.create)}}class X{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(Y,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new W(r,o,n)}}const Y=/\{\$([^}]+)}/g;function J(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(Z(n)&&Z(s)){if(!J(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function Z(t){return null!==t&&"object"==typeof t}function tt(t){return t&&t._delegate?t._delegate:t}class et{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const nt="[DEFAULT]";class rt{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new z;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(!this.isInitialized(e)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:e})}catch(t){if(n)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:nt})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=nt){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=nt){return this.instances.has(t)}getOptions(t=nt){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),r=this.onInitCallbacks.get(n)??new Set;r.add(t),this.onInitCallbacks.set(n,r);const i=this.instances.get(n);return i&&t(i,n),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===nt?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}var r;return n||null}normalizeInstanceIdentifier(t=nt){return this.component?this.component.multipleInstances?t:nt:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class it{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new rt(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const st=[];var ot;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(ot||(ot={}));const at={debug:ot.DEBUG,verbose:ot.VERBOSE,info:ot.INFO,warn:ot.WARN,error:ot.ERROR,silent:ot.SILENT},ct=ot.INFO,ut={[ot.DEBUG]:"log",[ot.VERBOSE]:"log",[ot.INFO]:"info",[ot.WARN]:"warn",[ot.ERROR]:"error"},lt=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=ut[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class ht{constructor(t){this.name=t,this._logLevel=ct,this._logHandler=lt,this._userLogHandler=null,st.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in ot))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?at[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,ot.DEBUG,...t),this._logHandler(this,ot.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,ot.VERBOSE,...t),this._logHandler(this,ot.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,ot.INFO,...t),this._logHandler(this,ot.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,ot.WARN,...t),this._logHandler(this,ot.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,ot.ERROR,...t),this._logHandler(this,ot.ERROR,...t)}}let dt,ft;const mt=new WeakMap,pt=new WeakMap,gt=new WeakMap,yt=new WeakMap,wt=new WeakMap;let vt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return pt.get(t);if("objectStoreNames"===e)return t.objectStoreNames||gt.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Et(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function bt(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ft||(ft=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(_t(this),t),Et(mt.get(this))}:function(...t){return Et(e.apply(_t(this),t))}:function(t,...n){const r=e.call(_t(this),t,...n);return gt.set(r,t.sort?t.sort():[t]),Et(r)}:(t instanceof IDBTransaction&&function(t){if(pt.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));pt.set(t,e)}(t),n=t,(dt||(dt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,vt):t);var e,n}function Et(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(Et(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&mt.set(e,t)})).catch((()=>{})),wt.set(e,t),e}(t);if(yt.has(t))return yt.get(t);const e=bt(t);return e!==t&&(yt.set(t,e),wt.set(e,t)),e}const _t=t=>wt.get(t),Tt=["get","getKey","getAll","getAllKeys","count"],St=["put","add","delete","clear"],It=new Map;function Ct(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(It.get(e))return It.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=St.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Tt.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return It.set(e,s),s}var At;At=vt,vt={...At,get:(t,e,n)=>Ct(t,e)||At.get(t,e,n),has:(t,e)=>!!Ct(t,e)||At.has(t,e)};class xt{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===e?.type}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const Dt="@firebase/app",kt="0.14.4",Nt=new ht("@firebase/app"),Rt="@firebase/app-compat",Ot="@firebase/analytics-compat",Lt="@firebase/analytics",Mt="@firebase/app-check-compat",Pt="@firebase/app-check",Vt="@firebase/auth",Ft="@firebase/auth-compat",Ut="@firebase/database",Bt="@firebase/data-connect",jt="@firebase/database-compat",qt="@firebase/functions",zt="@firebase/functions-compat",$t="@firebase/installations",Gt="@firebase/installations-compat",Ht="@firebase/messaging",Kt="@firebase/messaging-compat",Qt="@firebase/performance",Wt="@firebase/performance-compat",Xt="@firebase/remote-config",Yt="@firebase/remote-config-compat",Jt="@firebase/storage",Zt="@firebase/storage-compat",te="@firebase/firestore",ee="@firebase/ai",ne="@firebase/firestore-compat",re="firebase",ie="[DEFAULT]",se={[Dt]:"fire-core",[Rt]:"fire-core-compat",[Lt]:"fire-analytics",[Ot]:"fire-analytics-compat",[Pt]:"fire-app-check",[Mt]:"fire-app-check-compat",[Vt]:"fire-auth",[Ft]:"fire-auth-compat",[Ut]:"fire-rtdb",[Bt]:"fire-data-connect",[jt]:"fire-rtdb-compat",[qt]:"fire-fn",[zt]:"fire-fn-compat",[$t]:"fire-iid",[Gt]:"fire-iid-compat",[Ht]:"fire-fcm",[Kt]:"fire-fcm-compat",[Qt]:"fire-perf",[Wt]:"fire-perf-compat",[Xt]:"fire-rc",[Yt]:"fire-rc-compat",[Jt]:"fire-gcs",[Zt]:"fire-gcs-compat",[te]:"fire-fst",[ne]:"fire-fst-compat",[ee]:"fire-vertex","fire-js":"fire-js",[re]:"fire-js-all"},oe=new Map,ae=new Map,ce=new Map;function ue(t,e){try{t.container.addComponent(e)}catch(n){Nt.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function le(t){const e=t.name;if(ce.has(e))return Nt.debug(`There were multiple attempts to register component ${e}.`),!1;ce.set(e,t);for(const e of oe.values())ue(e,t);for(const e of ae.values())ue(e,t);return!0}const he=new X("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class de{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new et("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw he.create("app-deleted",{appName:this._name})}}function fe(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r={name:ie,automaticDataCollectionEnabled:!0,...e},i=r.name;if("string"!=typeof i||!i)throw he.create("bad-app-name",{appName:String(i)});if(n||(n=q()),!n)throw he.create("no-options");const s=oe.get(i);if(s){if(J(n,s.options)&&J(r,s.config))return s;throw he.create("duplicate-app",{appName:i})}const o=new it(i);for(const t of ce.values())o.addComponent(t);const a=new de(n,r,o);return oe.set(i,a),a}function me(t,e,n){let r=se[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){const t=[`Unable to register library "${r}" with version "${e}":`];return i&&t.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&t.push("and"),s&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void Nt.warn(t.join(" "))}le(new et(`${r}-version`,(()=>({library:r,version:e})),"VERSION"))}const pe="firebase-heartbeat-store";let ge=null;function ye(){return ge||(ge=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=Et(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(Et(o.result),t.oldVersion,t.newVersion,Et(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(pe)}catch(t){console.warn(t)}}}).catch((t=>{throw he.create("idb-open",{originalErrorMessage:t.message})}))),ge}async function we(t,e){try{const n=(await ye()).transaction(pe,"readwrite"),r=n.objectStore(pe);await r.put(e,ve(t)),await n.done}catch(t){if(t instanceof W)Nt.warn(t.message);else{const e=he.create("idb-set",{originalErrorMessage:t?.message});Nt.warn(e.message)}}}function ve(t){return`${t.name}!${t.options.appId}`}class be{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new _e(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=Ee();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===e||this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return;if(this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Nt.warn(t)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const t=Ee(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),Te(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Te(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=B(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return Nt.warn(t),""}}}function Ee(){return(new Date).toISOString().substring(0,10)}class _e{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await ye()).transaction(pe),n=await e.objectStore(pe).get(ve(t));return await e.done,n}catch(t){if(t instanceof W)Nt.warn(t.message);else{const e=he.create("idb-get",{originalErrorMessage:t?.message});Nt.warn(e.message)}}}(this.app);return t?.heartbeats?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const e=await this.read();return we(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??e.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){if(await this._canUseIndexedDBPromise){const e=await this.read();return we(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??e.lastSentHeartbeatDate,heartbeats:[...e.heartbeats,...t.heartbeats]})}}}function Te(t){return B(JSON.stringify({version:2,heartbeats:t})).length}le(new et("platform-logger",(t=>new xt(t)),"PRIVATE")),le(new et("heartbeat",(t=>new be(t)),"PRIVATE")),me(Dt,kt,""),me(Dt,kt,"esm2020"),me("fire-js",""),me("firebase","12.4.0","app");var Se,Ie,Ce="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ae={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(t,e,n){n||(n=0);const r=Array(16);if("string"==typeof e)for(var i=0;i<16;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];let s,o=t.g[3];s=e+(o^n&(i^o))+r[0]+3614090360&4294967295,s=o+(i^(e=n+(s<<7&4294967295|s>>>25))&(n^i))+r[1]+3905402710&4294967295,o=e+(s<<12&4294967295|s>>>20),s=i+(n^o&(e^n))+r[2]+606105819&4294967295,s=n+(e^(i=o+(s<<17&4294967295|s>>>15))&(o^e))+r[3]+3250441966&4294967295,s=e+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[4]+4118548399&4294967295,s=o+(i^(e=n+(s<<7&4294967295|s>>>25))&(n^i))+r[5]+1200080426&4294967295,o=e+(s<<12&4294967295|s>>>20),s=i+(n^o&(e^n))+r[6]+2821735955&4294967295,s=n+(e^(i=o+(s<<17&4294967295|s>>>15))&(o^e))+r[7]+4249261313&4294967295,s=e+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[8]+1770035416&4294967295,s=o+(i^(e=n+(s<<7&4294967295|s>>>25))&(n^i))+r[9]+2336552879&4294967295,o=e+(s<<12&4294967295|s>>>20),s=i+(n^o&(e^n))+r[10]+4294925233&4294967295,s=n+(e^(i=o+(s<<17&4294967295|s>>>15))&(o^e))+r[11]+2304563134&4294967295,s=e+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[12]+1804603682&4294967295,s=o+(i^(e=n+(s<<7&4294967295|s>>>25))&(n^i))+r[13]+4254626195&4294967295,o=e+(s<<12&4294967295|s>>>20),s=i+(n^o&(e^n))+r[14]+2792965006&4294967295,s=n+(e^(i=o+(s<<17&4294967295|s>>>15))&(o^e))+r[15]+1236535329&4294967295,s=e+(i^o&((n=i+(s<<22&4294967295|s>>>10))^i))+r[1]+4129170786&4294967295,s=o+(n^i&((e=n+(s<<5&4294967295|s>>>27))^n))+r[6]+3225465664&4294967295,o=e+(s<<9&4294967295|s>>>23),s=i+(e^n&(o^e))+r[11]+643717713&4294967295,s=n+(o^e&((i=o+(s<<14&4294967295|s>>>18))^o))+r[0]+3921069994&4294967295,s=e+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[5]+3593408605&4294967295,s=o+(n^i&((e=n+(s<<5&4294967295|s>>>27))^n))+r[10]+38016083&4294967295,o=e+(s<<9&4294967295|s>>>23),s=i+(e^n&(o^e))+r[15]+3634488961&4294967295,s=n+(o^e&((i=o+(s<<14&4294967295|s>>>18))^o))+r[4]+3889429448&4294967295,s=e+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[9]+568446438&4294967295,s=o+(n^i&((e=n+(s<<5&4294967295|s>>>27))^n))+r[14]+3275163606&4294967295,o=e+(s<<9&4294967295|s>>>23),s=i+(e^n&(o^e))+r[3]+4107603335&4294967295,s=n+(o^e&((i=o+(s<<14&4294967295|s>>>18))^o))+r[8]+1163531501&4294967295,s=e+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[13]+2850285829&4294967295,s=o+(n^i&((e=n+(s<<5&4294967295|s>>>27))^n))+r[2]+4243563512&4294967295,o=e+(s<<9&4294967295|s>>>23),s=i+(e^n&(o^e))+r[7]+1735328473&4294967295,s=n+(o^e&((i=o+(s<<14&4294967295|s>>>18))^o))+r[12]+2368359562&4294967295,s=e+((n=i+(s<<20&4294967295|s>>>12))^i^o)+r[5]+4294588738&4294967295,s=o+((e=n+(s<<4&4294967295|s>>>28))^n^i)+r[8]+2272392833&4294967295,o=e+(s<<11&4294967295|s>>>21),s=i+(o^e^n)+r[11]+1839030562&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^e)+r[14]+4259657740&4294967295,s=e+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[1]+2763975236&4294967295,s=o+((e=n+(s<<4&4294967295|s>>>28))^n^i)+r[4]+1272893353&4294967295,o=e+(s<<11&4294967295|s>>>21),s=i+(o^e^n)+r[7]+4139469664&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^e)+r[10]+3200236656&4294967295,s=e+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[13]+681279174&4294967295,s=o+((e=n+(s<<4&4294967295|s>>>28))^n^i)+r[0]+3936430074&4294967295,o=e+(s<<11&4294967295|s>>>21),s=i+(o^e^n)+r[3]+3572445317&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^e)+r[6]+76029189&4294967295,s=e+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[9]+3654602809&4294967295,s=o+((e=n+(s<<4&4294967295|s>>>28))^n^i)+r[12]+3873151461&4294967295,o=e+(s<<11&4294967295|s>>>21),s=i+(o^e^n)+r[15]+530742520&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^e)+r[2]+3299628645&4294967295,s=e+(i^((n=i+(s<<23&4294967295|s>>>9))|~o))+r[0]+4096336452&4294967295,s=o+(n^((e=n+(s<<6&4294967295|s>>>26))|~i))+r[7]+1126891415&4294967295,o=e+(s<<10&4294967295|s>>>22),s=i+(e^(o|~n))+r[14]+2878612391&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~e))+r[5]+4237533241&4294967295,s=e+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[12]+1700485571&4294967295,s=o+(n^((e=n+(s<<6&4294967295|s>>>26))|~i))+r[3]+2399980690&4294967295,o=e+(s<<10&4294967295|s>>>22),s=i+(e^(o|~n))+r[10]+4293915773&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~e))+r[1]+2240044497&4294967295,s=e+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[8]+1873313359&4294967295,s=o+(n^((e=n+(s<<6&4294967295|s>>>26))|~i))+r[15]+4264355552&4294967295,o=e+(s<<10&4294967295|s>>>22),s=i+(e^(o|~n))+r[6]+2734768916&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~e))+r[13]+1309151649&4294967295,s=e+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[4]+4149444226&4294967295,s=o+(n^((e=n+(s<<6&4294967295|s>>>26))|~i))+r[11]+3174756917&4294967295,o=e+(s<<10&4294967295|s>>>22),s=i+(e^(o|~n))+r[2]+718787259&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(s<<21&4294967295|s>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+o&4294967295}function r(t,e){this.h=e;const n=[];let r=!0;for(let i=t.length-1;i>=0;i--){const s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.F=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.D=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}(e,(function(){this.blockSize=-1})),e.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.v=function(t,e){void 0===e&&(e=t.length);const r=e-this.blockSize,i=this.C;let s=this.h,o=0;for(;o<e;){if(0==s)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(i[s++]=t.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<e;)if(i[s++]=t[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=e},e.prototype.A=function(){var t=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;e=8*this.o;for(var n=t.length-8;n<t.length;++n)t[n]=255&e,e/=256;for(this.v(t),t=Array(16),e=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)t[e++]=this.g[n]>>>r&255;return t};var i={};function s(t){return-128<=t&&t<128?function(t){var e=i;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=function(t){return new r([0|t],t<0?-1:0)}(t)}(t):new r([0|t],t<0?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(t<0)return d(o(-t));const e=[];let n=1;for(let r=0;t>=n;r++)e[r]=t/n|0,n*=4294967296;return new r(e,0)}var a=s(0),c=s(1),u=s(16777216);function l(t){if(0!=t.h)return!1;for(let e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function h(t){return-1==t.h}function d(t){const e=t.g.length,n=[];for(let r=0;r<e;r++)n[r]=~t.g[r];return new r(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function m(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function p(t,e){this.g=t,this.h=e}function g(t,e){if(l(e))throw Error("division by zero");if(l(t))return new p(a,a);if(h(t))return e=g(d(t),e),new p(d(e.g),d(e.h));if(h(e))return e=g(t,d(e)),new p(d(e.g),e.h);if(t.g.length>30){if(h(t)||h(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=e;r.l(t)<=0;)n=y(n),r=y(r);var i=w(n,1),s=w(r,1);for(r=w(r,2),n=w(n,2);!l(r);){var u=s.add(r);u.l(t)<=0&&(i=i.add(n),s=u),r=w(r,1),n=w(n,1)}return e=f(t,i.j(e)),new p(i,e)}for(i=a;t.l(e)>=0;){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),u=(s=o(n)).j(e);h(u)||u.l(t)>0;)u=(s=o(n-=r)).j(e);l(s)&&(s=c),i=i.add(s),t=f(t,u)}return new p(i,t)}function y(t){const e=t.g.length+1,n=[];for(let r=0;r<e;r++)n[r]=t.i(r)<<1|t.i(r-1)>>>31;return new r(n,t.h)}function w(t,e){const n=e>>5;e%=32;const i=t.g.length-n,s=[];for(let r=0;r<i;r++)s[r]=e>0?t.i(r+n)>>>e|t.i(r+n+1)<<32-e:t.i(r+n);return new r(s,t.h)}(t=r.prototype).m=function(){if(h(this))return-d(this).m();let t=0,e=1;for(let n=0;n<this.g.length;n++){const r=this.i(n);t+=(r>=0?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if(l(this))return"0";if(h(this))return"-"+d(this).toString(t);const e=o(Math.pow(t,6));var n=this;let r="";for(;;){const i=g(n,e).g;let s=(((n=f(n,i.j(e))).g.length>0?n.g[0]:n.h)>>>0).toString(t);if(l(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},t.i=function(t){return t<0?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return h(t=f(this,t))?-1:l(t)?0:1},t.abs=function(){return h(this)?d(this):this},t.add=function(t){const e=Math.max(this.g.length,t.g.length),n=[];let i=0;for(let r=0;r<=e;r++){let e=i+(65535&this.i(r))+(65535&t.i(r)),s=(e>>>16)+(this.i(r)>>>16)+(t.i(r)>>>16);i=s>>>16,e&=65535,s&=65535,n[r]=s<<16|e}return new r(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(l(this)||l(t))return a;if(h(this))return h(t)?d(this).j(d(t)):d(d(this).j(t));if(h(t))return d(this.j(d(t)));if(this.l(u)<0&&t.l(u)<0)return o(this.m()*t.m());const e=this.g.length+t.g.length,n=[];for(var i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(let e=0;e<t.g.length;e++){const r=this.i(i)>>>16,s=65535&this.i(i),o=t.i(e)>>>16,a=65535&t.i(e);n[2*i+2*e]+=s*a,m(n,2*i+2*e),n[2*i+2*e+1]+=r*a,m(n,2*i+2*e+1),n[2*i+2*e+1]+=s*o,m(n,2*i+2*e+1),n[2*i+2*e+2]+=r*o,m(n,2*i+2*e+2)}for(t=0;t<e;t++)n[t]=n[2*t+1]<<16|n[2*t];for(t=e;t<2*e;t++)n[t]=0;return new r(n,0)},t.B=function(t){return g(this,t).h},t.and=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)&t.i(r);return new r(n,this.h&t.h)},t.or=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)|t.i(r);return new r(n,this.h|t.h)},t.xor=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)^t.i(r);return new r(n,this.h^t.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,Ie=Ae.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=o(Math.pow(n,8));let i=a;for(let t=0;t<e.length;t+=8){var s=Math.min(8,e.length-t);const a=parseInt(e.substring(t,t+s),n);s<8?(s=o(Math.pow(n,s)),i=i.j(s).add(o(a))):(i=i.j(r),i=i.add(o(a)))}return i},Se=Ae.Integer=r}).apply(void 0!==Ce?Ce:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var xe,De,ke,Ne,Re,Oe,Le,Me,Pe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ve={};(function(){var t,e=Object.defineProperty,n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Pe&&Pe];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(t,r){if(r)t:{var i=n;t=t.split(".");for(var s=0;s<t.length-1;s++){var o=t[s];if(!(o in i))break t;i=i[o]}(r=r(s=i[t=t[t.length-1]]))!=s&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",(function(t){return t||Symbol("Symbol.dispose")})),r("Array.prototype.values",(function(t){return t||function(){return this[Symbol.iterator]()}})),r("Object.entries",(function(t){return t||function(t){var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push([e,t[e]]);return n}}));var i=i||{},s=this||self;function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){return(c=a).apply(null,arguments)}function u(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function l(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Ob=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}var h="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?t=>t&&AsyncContext.Snapshot.wrap(t):t=>t;function d(t){const e=t.length;if(e>0){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function f(t,e){for(let e=1;e<arguments.length;e++){const r=arguments[e];var n=typeof r;if("array"==(n="object"!=n?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){n=t.length||0;const e=r.length||0;t.length=n+e;for(let i=0;i<e;i++)t[n+i]=r[i]}else t.push(r)}}function m(t){s.setTimeout((()=>{throw t}),0)}function p(){var t=b;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var g=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return this.h>0?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new y),(t=>t.reset()));class y{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let w,v=!1,b=new class{constructor(){this.h=this.g=null}add(t,e){const n=g.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},E=()=>{const t=Promise.resolve(void 0);w=()=>{t.then(_)}};function _(){for(var t;t=p();){try{t.h.call(t.g)}catch(t){m(t)}var e=g;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}v=!1}function T(){this.u=this.u,this.C=this.C}function S(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},S.prototype.h=function(){this.defaultPrevented=!0};var I=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};s.addEventListener("test",t,e),s.removeEventListener("test",t,e)}catch(t){}return t}();function C(t){return/^[\s\xa0]*$/.test(t)}function A(t,e){S.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t&&this.init(t,e)}l(A,S),A.prototype.init=function(t,e){const n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;this.target=t.target||t.srcElement,this.g=e,(e=t.relatedTarget)||("mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement)),this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=t.pointerType,this.state=t.state,this.i=t,t.defaultPrevented&&A.Z.h.call(this)},A.prototype.h=function(){A.Z.h.call(this);const t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var x="closure_listenable_"+(1e6*Math.random()|0),D=0;function k(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=i,this.key=++D,this.da=this.fa=!1}function N(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function R(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function O(t){const e={};for(const n in t)e[n]=t[n];return e}const L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function M(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<L.length;e++)n=L[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function P(t){this.src=t,this.g={},this.h=0}function V(t,e){const n=e.type;if(n in t.g){var r,i=t.g[n],s=Array.prototype.indexOf.call(i,e,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(N(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function F(t,e,n,r){for(let i=0;i<t.length;++i){const s=t[i];if(!s.da&&s.listener==e&&s.capture==!!n&&s.ha==r)return i}return-1}P.prototype.add=function(t,e,n,r,i){const s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);const o=F(t,e,r,i);return o>-1?(e=t[o],n||(e.fa=!1)):((e=new k(e,this.src,s,!!r,i)).fa=n,t.push(e)),e};var U="closure_lm_"+(1e6*Math.random()|0),B={};function j(t,e,n,r,i){if(r&&r.once)return z(t,e,n,r,i);if(Array.isArray(e)){for(let s=0;s<e.length;s++)j(t,e[s],n,r,i);return null}return n=X(n),t&&t[x]?t.J(e,n,o(r)?!!r.capture:!!r,i):q(t,e,n,!1,r,i)}function q(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");const a=o(i)?!!i.capture:!!i;let c=Q(t);if(c||(t[U]=c=new P(t)),(n=c.add(e,n,r,a,s)).proxy)return n;if(r=function(){const t=K;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)I||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(H(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function z(t,e,n,r,i){if(Array.isArray(e)){for(let s=0;s<e.length;s++)z(t,e[s],n,r,i);return null}return n=X(n),t&&t[x]?t.K(e,n,o(r)?!!r.capture:!!r,i):q(t,e,n,!0,r,i)}function $(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)$(t,e[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=X(n),t&&t[x]?(t=t.i,(s=String(e).toString())in t.g&&(n=F(e=t.g[s],n,r,i))>-1&&(N(e[n]),Array.prototype.splice.call(e,n,1),0==e.length&&(delete t.g[s],t.h--))):t&&(t=Q(t))&&(e=t.g[e.toString()],t=-1,e&&(t=F(e,n,r,i)),(n=t>-1?e[t]:null)&&G(n))}function G(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[x])V(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(H(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Q(e))?(V(n,t),0==n.h&&(n.src=null,e[U]=null)):N(t)}}}function H(t){return t in B?B[t]:B[t]="on"+t}function K(t,e){if(t.da)t=!0;else{e=new A(e,this);const n=t.listener,r=t.ha||t.src;t.fa&&G(t),t=n.call(r,e)}return t}function Q(t){return(t=t[U])instanceof P?t:null}var W="__closure_events_fn_"+(1e9*Math.random()>>>0);function X(t){return"function"==typeof t?t:(t[W]||(t[W]=function(e){return t.handleEvent(e)}),t[W])}function Y(){T.call(this),this.i=new P(this),this.M=this,this.G=null}function J(t,e){var n,r=t.G;if(r)for(n=[];r;r=r.G)n.push(r);if(t=t.M,r=e.type||e,"string"==typeof e)e=new S(e,t);else if(e instanceof S)e.target=e.target||t;else{var i=e;M(e=new S(r,t),i)}let s,o;if(i=!0,n)for(o=n.length-1;o>=0;o--)s=e.g=n[o],i=Z(s,r,!0,e)&&i;if(s=e.g=t,i=Z(s,r,!0,e)&&i,i=Z(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)s=e.g=n[o],i=Z(s,r,!1,e)&&i}function Z(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();let i=!0;for(let s=0;s<e.length;++s){const o=e[s];if(o&&!o.da&&o.capture==n){const e=o.listener,n=o.ha||o.src;o.fa&&V(t.i,o),i=!1!==e.call(n,r)&&i}}return i&&!r.defaultPrevented}function tt(t){t.g=function(t,e){if("function"!=typeof t){if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=c(t.handleEvent,t)}return Number(e)>2147483647?-1:s.setTimeout(t,e||0)}((()=>{t.g=null,t.i&&(t.i=!1,tt(t))}),t.l);const e=t.h;t.h=null,t.m.apply(null,e)}l(Y,T),Y.prototype[x]=!0,Y.prototype.removeEventListener=function(t,e,n,r){$(this,t,e,n,r)},Y.prototype.N=function(){if(Y.Z.N.call(this),this.i){var t=this.i;for(const e in t.g){const n=t.g[e];for(let t=0;t<n.length;t++)N(n[t]);delete t.g[e],t.h--}}this.G=null},Y.prototype.J=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Y.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class et extends T{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:tt(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function nt(t){T.call(this),this.h=t,this.g={}}l(nt,T);var rt=[];function it(t){R(t.g,(function(t,e){this.g.hasOwnProperty(e)&&G(t)}),t),t.g={}}nt.prototype.N=function(){nt.Z.N.call(this),it(this)},nt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var st=s.JSON.stringify,ot=s.JSON.parse,at=class{stringify(t){return s.JSON.stringify(t,void 0)}parse(t){return s.JSON.parse(t,void 0)}};function ct(){}function ut(){}var lt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ht(){S.call(this,"d")}function dt(){S.call(this,"c")}l(ht,S),l(dt,S);var ft={},mt=null;function pt(){return mt=mt||new Y}function gt(t){S.call(this,ft.Ia,t)}function yt(t){const e=pt();J(e,new gt(e))}function wt(t,e){S.call(this,ft.STAT_EVENT,t),this.stat=e}function vt(t){const e=pt();J(e,new wt(e,t))}function bt(t,e){S.call(this,ft.Ja,t),this.size=e}function Et(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return s.setTimeout((function(){t()}),e)}function _t(){this.g=!0}function Tt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{const s=JSON.parse(e);if(s)for(t=0;t<s.length;t++)if(Array.isArray(s[t])){var n=s[t];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let t=1;t<r.length;t++)r[t]=""}}}return st(s)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}ft.Ia="serverreachability",l(gt,S),ft.STAT_EVENT="statevent",l(wt,S),ft.Ja="timingevent",l(bt,S),_t.prototype.ua=function(){this.g=!1},_t.prototype.info=function(){};var St,It={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ct={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function At(){}function xt(t){return encodeURIComponent(String(t))}function Dt(t){var e=1;t=t.split(":");const n=[];for(;e>0&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function kt(t,e,n,r){this.j=t,this.i=e,this.l=n,this.S=r||1,this.V=new nt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Nt}function Nt(){this.i=null,this.g="",this.h=!1}l(At,ct),At.prototype.g=function(){return new XMLHttpRequest},St=new At;var Rt={},Ot={};function Lt(t,e,n){t.M=1,t.A=se(te(e)),t.u=n,t.R=!0,Mt(t,null)}function Mt(t,e){t.F=Date.now(),Ft(t),t.B=te(t.A);var n=t.B,r=t.S;Array.isArray(r)||(r=[String(r)]),ve(n.i,"t",r),t.C=0,n=t.j.L,t.h=new Nt,t.g=gn(t.j,n?e:null,!t.u),t.P>0&&(t.O=new et(c(t.Y,t,t.g),t.P)),e=t.V,n=t.g,r=t.ba;var i="readystatechange";Array.isArray(i)||(i&&(rt[0]=i.toString()),i=rt);for(let t=0;t<i.length;t++){const s=j(n,i[t],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}e=t.J?O(t.J):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.B,t.v,t.u,e)):(t.v="GET",t.g.ea(t.B,t.v,null,e)),yt(),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s){var o="",a=s.split("&");for(let t=0;t<a.length;t++){var c=a[t].split("=");if(c.length>1){const t=c[0];c=c[1];const e=t.split("_");o=e.length>=2&&"type"==e[1]?o+(t+"=")+c+"&":o+(t+"=redacted&")}}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.i,t.v,t.B,t.l,t.S,t.u)}function Pt(t){return!!t.g&&"GET"==t.v&&2!=t.M&&t.j.Aa}function Vt(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Ot:(n=Number(e.substring(n,r)),isNaN(n)?Rt:(r+=1)+n>e.length?Ot:(e=e.slice(r,r+n),t.C=r+n,e))}function Ft(t){t.T=Date.now()+t.H,Ut(t,t.H)}function Ut(t,e){if(null!=t.D)throw Error("WatchDog timer not null");t.D=Et(c(t.aa,t),e)}function Bt(t){t.D&&(s.clearTimeout(t.D),t.D=null)}function jt(t){0==t.j.I||t.K||hn(t.j,t)}function qt(t){Bt(t);var e=t.O;e&&"function"==typeof e.dispose&&e.dispose(),t.O=null,it(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.dispose())}function zt(t,e){try{var n=t.j;if(0!=n.I&&(n.g==t||Qt(n.h,t)))if(!t.L&&Qt(n.h,t)&&3==n.I){try{var r=n.Ba.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.v){if(n.g){if(!(n.g.F+3e3<t.F))break t;ln(n),Ze(n)}an(n),vt(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=Et(c(n.Va,n),6e3));Kt(n.h)<=1&&n.ta&&(n.ta=void 0)}else fn(n,11)}else if((t.L||n.g==t)&&ln(n),!C(e))for(i=n.Ba.g.parse(e),e=0;e<i.length;e++){let c=i[e];const l=c[0];if(!(l<=n.K))if(n.K=l,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const e=c[3];null!=e&&(n.ka=e,n.j.info("VER="+n.ka));const i=c[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));const l=c[5];null!=l&&"number"==typeof l&&l>0&&(r=1.5*l,n.O=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.h;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Wt(s,s.h),s.h=null))}if(r.G){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.wa=t,ie(r.J,r.G,t))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-t.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=t;if((r=n).na=pn(r,r.L?r.ba:null,r.W),o.L){Xt(r.h,o);var a=o,u=r.O;u&&(a.H=u),a.D&&(Bt(a),Ft(a)),r.g=o}else on(r);n.i.length>0&&en(n)}else"stop"!=c[0]&&"close"!=c[0]||fn(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?fn(n,7):Je(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}yt()}catch(t){}}kt.prototype.ba=function(t){t=t.target;const e=this.O;e&&3==Qe(t)?e.j():this.Y(t)},kt.prototype.Y=function(t){try{if(t==this.g)t:{const c=Qe(this.g),u=this.g.ya();if(this.g.ca(),!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||We(this.g)))){this.K||4!=c||7==u||yt(),Bt(this);var e=this.g.ca();this.X=e;var n=function(t){if(!Pt(t))return t.g.la();const e=We(t.g);if(""===e)return"";let n="";const r=e.length,i=4==Qe(t.g);if(!t.h.i){if("undefined"==typeof TextDecoder)return qt(t),jt(t),"";t.h.i=new s.TextDecoder}for(let s=0;s<r;s++)t.h.h=!0,n+=t.h.i.decode(e[s],{stream:!(i&&s==r-1)});return e.length=0,t.h.g+=n,t.C=0,t.h.g}(this);if(this.o=200==e,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.i,this.v,this.B,this.l,this.S,c,e),this.o){if(this.U&&!this.L){e:{if(this.g){var r,i=this.g;if((r=i.g?i.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(r)){var o=r;break e}}o=null}if(!(t=o)){this.o=!1,this.m=3,vt(12),qt(this),jt(this);break t}Tt(this.i,this.l,t,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,zt(this,t)}if(this.R){let e;for(t=!0;!this.K&&this.C<n.length;){if(e=Vt(this,n),e==Ot){4==c&&(this.m=4,vt(14),t=!1),Tt(this.i,this.l,null,"[Incomplete Response]");break}if(e==Rt){this.m=4,vt(15),Tt(this.i,this.l,n,"[Invalid Chunk]"),t=!1;break}Tt(this.i,this.l,e,null),zt(this,e)}if(Pt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,vt(16),t=!1),this.o=this.o&&t,t){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),cn(a),a.P=!0,vt(11))}}else Tt(this.i,this.l,n,"[Invalid Chunked Response]"),qt(this),jt(this)}else Tt(this.i,this.l,n,null),zt(this,n);4==c&&qt(this),this.o&&!this.K&&(4==c?hn(this.j,this):(this.o=!1,Ft(this)))}else(function(t){const e={};t=(t.g&&Qe(t)>=2&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(C(t[r]))continue;var n=Dt(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==e&&n.indexOf("Unknown SID")>0?(this.m=3,vt(12)):(this.m=0,vt(13)),qt(this),jt(this)}}}catch(t){}},kt.prototype.cancel=function(){this.K=!0,qt(this)},kt.prototype.aa=function(){this.D=null;const t=Date.now();t-this.T>=0?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.i,this.B),2!=this.M&&(yt(),vt(17)),qt(this),this.m=2,jt(this)):Ut(this,this.T-t)};var $t=class{constructor(t,e){this.g=t,this.map=e}};function Gt(t){this.l=t||10,t=s.PerformanceNavigationTiming?(t=s.performance.getEntriesByType("navigation")).length>0&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ht(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Kt(t){return t.h?1:t.g?t.g.size:0}function Qt(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Wt(t,e){t.g?t.g.add(e):t.h=e}function Xt(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Yt(t){if(null!=t.h)return t.i.concat(t.h.G);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.G);return e}return d(t.i)}Gt.prototype.cancel=function(){if(this.i=Yt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var Jt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Zt(t){let e;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,t instanceof Zt?(this.l=t.l,ee(this,t.j),this.o=t.o,this.g=t.g,ne(this,t.u),this.h=t.h,re(this,be(t.i)),this.m=t.m):t&&(e=String(t).match(Jt))?(this.l=!1,ee(this,e[1]||"",!0),this.o=oe(e[2]||""),this.g=oe(e[3]||"",!0),ne(this,e[4]),this.h=oe(e[5]||"",!0),re(this,e[6]||"",!0),this.m=oe(e[7]||"")):(this.l=!1,this.i=new me(null,this.l))}function te(t){return new Zt(t)}function ee(t,e,n){t.j=n?oe(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ne(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.u=e}else t.u=null}function re(t,e,n){e instanceof me?(t.i=e,function(t,e){e&&!t.j&&(pe(t),t.i=null,t.g.forEach((function(t,e){const n=e.toLowerCase();e!=n&&(ge(this,e),ve(this,n,t))}),t)),t.j=e}(t.i,t.l)):(n||(e=ae(e,de)),t.i=new me(e,t.l))}function ie(t,e,n){t.i.set(e,n)}function se(t){return ie(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function oe(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ae(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ce),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ce(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Zt.prototype.toString=function(){const t=[];var e=this.j;e&&t.push(ae(e,ue,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(ae(e,ue,!0),"@"),t.push(xt(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&t.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(ae(n,"/"==n.charAt(0)?he:le,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",ae(n,fe)),t.join("")},Zt.prototype.resolve=function(t){const e=te(this);let n=!!t.j;n?ee(e,t.j):n=!!t.o,n?e.o=t.o:n=!!t.g,n?e.g=t.g:n=null!=t.u;var r=t.h;if(n)ne(e,t.u);else if(n=!!t.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=e.h.lastIndexOf("/");-1!=i&&(r=e.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");const t=[];for(let e=0;e<i.length;){const n=i[e++];"."==n?r&&e==i.length&&t.push(""):".."==n?((t.length>1||1==t.length&&""!=t[0])&&t.pop(),r&&e==i.length&&t.push("")):(t.push(n),r=!0)}r=t.join("/")}else r=i}return n?e.h=r:n=""!==t.i.toString(),n?re(e,be(t.i)):n=!!t.m,n&&(e.m=t.m),e};var ue=/[#\/\?@]/g,le=/[#\?:]/g,he=/[#\?]/g,de=/[#\?@]/g,fe=/#/g;function me(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function pe(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(let n=0;n<t.length;n++){const r=t[n].indexOf("=");let i,s=null;r>=0?(i=t[n].substring(0,r),s=t[n].substring(r+1)):i=t[n],e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function ge(t,e){pe(t),e=Ee(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function ye(t,e){return pe(t),e=Ee(t,e),t.g.has(e)}function we(t,e){pe(t);let n=[];if("string"==typeof e)ye(t,e)&&(n=n.concat(t.g.get(Ee(t,e))));else for(t=Array.from(t.g.values()),e=0;e<t.length;e++)n=n.concat(t[e]);return n}function ve(t,e,n){ge(t,e),n.length>0&&(t.i=null,t.g.set(Ee(t,e),d(n)),t.h+=n.length)}function be(t){const e=new me;return e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),e}function Ee(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function _e(t,e,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(t){}}function Te(){this.g=new at}function Se(t){this.i=t.Sb||null,this.h=t.ab||!1}function Ie(t,e){Y.call(this),this.H=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Ce(t){t.j.read().then(t.Ma.bind(t)).catch(t.ga.bind(t))}function Ae(t){t.readyState=4,t.l=null,t.j=null,t.B=null,Fe(t)}function Fe(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Ue(t){let e="";return R(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Be(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Ue(n),"string"==typeof t?null!=n&&xt(n):ie(t,e,n))}function je(t){Y.call(this),this.headers=new Map,this.L=t||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=me.prototype).add=function(t,e){pe(this),this.i=null,t=Ee(this,t);let n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){pe(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},t.set=function(t,e){return pe(this),this.i=null,ye(this,t=Ee(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&(t=we(this,t)).length>0?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(let r=0;r<e.length;r++){var n=e[r];const i=xt(n);n=we(this,n);for(let e=0;e<n.length;e++){let r=i;""!==n[e]&&(r+="="+xt(n[e])),t.push(r)}}return this.i=t.join("&")},l(Se,ct),Se.prototype.g=function(){return new Ie(this.i,this.h)},l(Ie,Y),(t=Ie.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=t,this.D=e,this.readyState=1,Fe(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const e={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};t&&(e.body=t),(this.H||s).fetch(new Request(this.D,e)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Ae(this)),this.readyState=0},t.Pa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Fe(this)),this.g&&(this.readyState=3,Fe(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==s.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ce(this)}else t.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.B.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ae(this):Fe(this),3==this.readyState&&Ce(this)}},t.Oa=function(t){this.g&&(this.response=this.responseText=t,Ae(this))},t.Na=function(t){this.g&&(this.response=t,Ae(this))},t.ga=function(){this.g&&Ae(this)},t.setRequestHeader=function(t,e){this.A.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Ie.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),l(je,Y);var qe=/^https?$/i,ze=["POST","PUT"];function $e(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.o=5,Ge(t),Ke(t)}function Ge(t){t.A||(t.A=!0,J(t,"complete"),J(t,"error"))}function He(t){if(t.h&&void 0!==i)if(t.v&&4==Qe(t))setTimeout(t.Ca.bind(t),0);else if(J(t,"readystatechange"),4==Qe(t)){t.h=!1;try{const i=t.ca();t:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===i){let e=String(t.D).match(Jt)[1]||null;!e&&s.self&&s.self.location&&(e=s.self.location.protocol.slice(0,-1)),r=!qe.test(e?e.toLowerCase():"")}n=r}if(n)J(t,"complete"),J(t,"success");else{t.o=6;try{var o=Qe(t)>2?t.g.statusText:""}catch(t){o=""}t.l=o+" ["+t.ca()+"]",Ge(t)}}finally{Ke(t)}}}function Ke(t,e){if(t.g){t.m&&(clearTimeout(t.m),t.m=null);const n=t.g;t.g=null,e||J(t,"ready");try{n.onreadystatechange=null}catch(t){}}}function Qe(t){return t.g?t.g.readyState:0}function We(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.F){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Xe(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Ye(t){this.za=0,this.i=[],this.j=new _t,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Xe("failFast",!1,t),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Xe("baseRetryDelayMs",5e3,t),this.Za=Xe("retryDelaySeedMs",1e4,t),this.Ta=Xe("forwardChannelMaxRetries",2,t),this.va=Xe("forwardChannelRequestTimeoutMs",2e4,t),this.ma=t&&t.xmlHttpFactory||void 0,this.Ua=t&&t.Rb||void 0,this.Aa=t&&t.useFetchStreams||!1,this.O=void 0,this.L=t&&t.supportsCrossDomainXhr||!1,this.M="",this.h=new Gt(t&&t.concurrentRequestLimit),this.Ba=new Te,this.S=t&&t.fastHandshake||!1,this.R=t&&t.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=t&&t.Pb||!1,t&&t.ua&&this.j.ua(),t&&t.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&t&&t.detectBufferingProxy||!1,this.ia=void 0,t&&t.longPollingTimeout&&t.longPollingTimeout>0&&(this.ia=t.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Je(t){if(tn(t),3==t.I){var e=t.V++,n=te(t.J);if(ie(n,"SID",t.M),ie(n,"RID",e),ie(n,"TYPE","terminate"),rn(t,n),(e=new kt(t,t.j,e)).M=2,e.A=se(te(n)),n=!1,s.navigator&&s.navigator.sendBeacon)try{n=s.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&s.Image&&((new Image).src=e.A,n=!0),n||(e.g=gn(e.j,null),e.g.ea(e.A)),e.F=Date.now(),Ft(e)}mn(t)}function Ze(t){t.g&&(cn(t),t.g.cancel(),t.g=null)}function tn(t){Ze(t),t.v&&(s.clearTimeout(t.v),t.v=null),ln(t),t.h.cancel(),t.m&&("number"==typeof t.m&&s.clearTimeout(t.m),t.m=null)}function en(t){if(!Ht(t.h)&&!t.m){t.m=!0;var e=t.Ea;w||E(),v||(w(),v=!0),b.add(e,t),t.D=0}}function nn(t,e){var n;n=e?e.l:t.V++;const r=te(t.J);ie(r,"SID",t.M),ie(r,"RID",n),ie(r,"AID",t.K),rn(t,r),t.u&&t.o&&Be(r,t.u,t.o),n=new kt(t,t.j,n,t.D+1),null===t.u&&(n.J=t.o),e&&(t.i=e.G.concat(t.i)),e=sn(t,n,1e3),n.H=Math.round(.5*t.va)+Math.round(.5*t.va*Math.random()),Wt(t.h,n),Lt(n,r,e)}function rn(t,e){t.H&&R(t.H,(function(t,n){ie(e,n,t)})),t.l&&R({},(function(t,n){ie(e,n,t)}))}function sn(t,e,n){n=Math.min(t.i.length,n);const r=t.l?c(t.l.Ka,t.l,t):null;t:{var i=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?n>0?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let c=!0;for(let u=0;u<n;u++){var s=i[u].g;const n=i[u].map;if((s-=e)<0)e=Math.max(0,i[u].g-100),c=!1;else try{s="req"+s+"_"||0;try{var a=n instanceof Map?n:Object.entries(n);for(const[e,n]of a){let r=n;o(n)&&(r=st(n)),t.push(s+e+"="+encodeURIComponent(r))}}catch(e){throw t.push(s+"type="+encodeURIComponent("_badmap")),e}}catch(t){r&&r(n)}}if(c){a=t.join("&");break t}}a=void 0}return t=t.i.splice(0,n),e.G=t,a}function on(t){if(!t.g&&!t.v){t.Y=1;var e=t.Da;w||E(),v||(w(),v=!0),b.add(e,t),t.A=0}}function an(t){return!(t.g||t.v||t.A>=3||(t.Y++,t.v=Et(c(t.Da,t),dn(t,t.A)),t.A++,0))}function cn(t){null!=t.B&&(s.clearTimeout(t.B),t.B=null)}function un(t){t.g=new kt(t,t.j,"rpc",t.Y),null===t.u&&(t.g.J=t.o),t.g.P=0;var e=te(t.na);ie(e,"RID","rpc"),ie(e,"SID",t.M),ie(e,"AID",t.K),ie(e,"CI",t.F?"0":"1"),!t.F&&t.ia&&ie(e,"TO",t.ia),ie(e,"TYPE","xmlhttp"),rn(t,e),t.u&&t.o&&Be(e,t.u,t.o),t.O&&(t.g.H=t.O);var n=t.g;t=t.ba,n.M=1,n.A=se(te(e)),n.u=null,n.R=!0,Mt(n,t)}function ln(t){null!=t.C&&(s.clearTimeout(t.C),t.C=null)}function hn(t,e){var n=null;if(t.g==e){ln(t),cn(t),t.g=null;var r=2}else{if(!Qt(t.h,e))return;n=e.G,Xt(t.h,e),r=1}if(0!=t.I)if(e.o)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.F;var i=t.D;J(r=pt(),new bt(r,n)),en(t)}else on(t);else if(3==(i=e.m)||0==i&&e.X>0||!(1==r&&function(t,e){return!(Kt(t.h)>=t.h.j-(t.m?1:0)||(t.m?(t.i=e.G.concat(t.i),0):1==t.I||2==t.I||t.D>=(t.Sa?0:t.Ta)||(t.m=Et(c(t.Ea,t,e),dn(t,t.D)),t.D++,0)))}(t,e)||2==r&&an(t)))switch(n&&n.length>0&&(e=t.h,e.i=e.i.concat(n)),i){case 1:fn(t,5);break;case 4:fn(t,10);break;case 3:fn(t,6);break;default:fn(t,2)}}function dn(t,e){let n=t.Qa+Math.floor(Math.random()*t.Za);return t.isActive()||(n*=2),n*e}function fn(t,e){if(t.j.info("Error code "+e),2==e){var n=c(t.bb,t),r=t.Ua;const e=!r;r=new Zt(r||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||ee(r,"https"),se(r),e?function(t,e){const n=new _t;if(s.Image){const r=new Image;r.onload=u(_e,n,"TestLoadImage: loaded",!0,e,r),r.onerror=u(_e,n,"TestLoadImage: error",!1,e,r),r.onabort=u(_e,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=u(_e,n,"TestLoadImage: timeout",!1,e,r),s.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new _t;const n=new AbortController,r=setTimeout((()=>{n.abort(),_e(0,0,!1,e)}),1e4);fetch(t,{signal:n.signal}).then((t=>{clearTimeout(r),t.ok?_e(0,0,!0,e):_e(0,0,!1,e)})).catch((()=>{clearTimeout(r),_e(0,0,!1,e)}))}(r.toString(),n)}else vt(2);t.I=0,t.l&&t.l.pa(e),mn(t),tn(t)}function mn(t){if(t.I=0,t.ja=[],t.l){const e=Yt(t.h);0==e.length&&0==t.i.length||(f(t.ja,e),f(t.ja,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.oa()}}function pn(t,e,n){var r=n instanceof Zt?te(n):new Zt(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ne(r,r.u);else{var i=s.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;const t=new Zt(null);r&&ee(t,r),e&&(t.g=e),i&&ne(t,i),n&&(t.h=n),r=t}return n=t.G,e=t.wa,n&&e&&ie(r,n,e),ie(r,"VER",t.ka),rn(t,r),r}function gn(t,e,n){if(e&&!t.L)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Aa&&!t.ma?new je(new Se({ab:n})):new je(t.ma)).Fa(t.L),e}function yn(){}function wn(){}function vn(t,e){Y.call(this),this.g=new Ye(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.sa&&(t?t["X-WebChannel-Client-Profile"]=e.sa:t={"X-WebChannel-Client-Profile":e.sa}),this.g.U=t,(t=e&&e.Qb)&&!C(t)&&(this.g.u=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!C(e)&&(this.g.G=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new _n(this)}function bn(t){ht.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function En(){dt.call(this),this.status=1}function _n(t){this.g=t}(t=je.prototype).Fa=function(t){this.H=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():St.g(),this.g.onreadystatechange=h(c(this.Ca,this));try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(t){return void $e(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),i=s.FormData&&t instanceof s.FormData,!(Array.prototype.indexOf.call(ze,e,void 0)>=0)||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(t){$e(this,t)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=t||7,J(this,"complete"),J(this,"abort"),Ke(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ke(this,!0)),je.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?He(this):this.Xa())},t.Xa=function(){He(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return Qe(this)>2?this.g.status:-1}catch(t){return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.La=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),ot(e)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=Ye.prototype).ka=8,t.I=1,t.connect=function(t,e,n,r){vt(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=pn(this,null,this.W),en(this)},t.Ea=function(t){if(this.m)if(this.m=null,1==this.I){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const i=new kt(this,this.j,t);let s=this.o;if(this.U&&(s?(s=O(s),M(s,this.U)):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if((e+=r)>4096){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=sn(this,i,e),ie(n=te(this.J),"RID",t),ie(n,"CVER",22),this.G&&ie(n,"X-HTTP-Session-Id",this.G),rn(this,n),s&&(this.R?e="headers="+xt(Ue(s))+"&"+e:this.u&&Be(n,this.u,s)),Wt(this.h,i),this.Ra&&ie(n,"TYPE","init"),this.S?(ie(n,"$req",e),ie(n,"SID","null"),i.U=!0,Lt(i,n,null)):Lt(i,n,e),this.I=2}}else 3==this.I&&(t?nn(this,t):0==this.i.length||Ht(this.h)||nn(this))},t.Da=function(){if(this.v=null,un(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var t=4*this.T;this.j.info("BP detection timer enabled: "+t),this.B=Et(c(this.Wa,this),t)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,vt(10),Ze(this),un(this))},t.Va=function(){null!=this.C&&(this.C=null,Ze(this),an(this),vt(19))},t.bb=function(t){t?(this.j.info("Successfully pinged google.com"),vt(2)):(this.j.info("Failed to ping google.com"),vt(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=yn.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},wn.prototype.g=function(t,e){return new vn(t,e)},l(vn,Y),vn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},vn.prototype.close=function(){Je(this.g)},vn.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=st(t),t=n);e.i.push(new $t(e.Ya++,t)),3==e.I&&en(e)},vn.prototype.N=function(){this.g.l=null,delete this.j,Je(this.g),delete this.g,vn.Z.N.call(this)},l(bn,ht),l(En,dt),l(_n,yn),_n.prototype.ra=function(){J(this.g,"a")},_n.prototype.qa=function(t){J(this.g,new bn(t))},_n.prototype.pa=function(t){J(this.g,new En)},_n.prototype.oa=function(){J(this.g,"b")},wn.prototype.createWebChannel=wn.prototype.g,vn.prototype.send=vn.prototype.o,vn.prototype.open=vn.prototype.m,vn.prototype.close=vn.prototype.close,Me=Ve.createWebChannelTransport=function(){return new wn},Le=Ve.getStatEventTarget=function(){return pt()},Oe=Ve.Event=ft,Re=Ve.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},It.NO_ERROR=0,It.TIMEOUT=8,It.HTTP_ERROR=6,Ne=Ve.ErrorCode=It,Ct.COMPLETE="complete",ke=Ve.EventType=Ct,ut.EventType=lt,lt.OPEN="a",lt.CLOSE="b",lt.ERROR="c",lt.MESSAGE="d",Y.prototype.listen=Y.prototype.J,De=Ve.WebChannel=ut,Ve.FetchXmlHttpFactory=Se,je.prototype.listenOnce=je.prototype.K,je.prototype.getLastError=je.prototype.Ha,je.prototype.getLastErrorCode=je.prototype.ya,je.prototype.getStatus=je.prototype.ca,je.prototype.getResponseJson=je.prototype.La,je.prototype.getResponseText=je.prototype.la,je.prototype.send=je.prototype.ea,je.prototype.setWithCredentials=je.prototype.Fa,xe=Ve.XhrIo=je}).apply(void 0!==Pe?Pe:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Fe="@firebase/firestore",Ue="4.9.2";class Be{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Be.UNAUTHENTICATED=new Be(null),Be.GOOGLE_CREDENTIALS=new Be("google-credentials-uid"),Be.FIRST_PARTY=new Be("first-party-uid"),Be.MOCK_USER=new Be("mock-user");let je="12.3.0";const qe=new ht("@firebase/firestore");function ze(){return qe.logLevel}function $e(t,...e){if(qe.logLevel<=ot.DEBUG){const n=e.map(Ke);qe.debug(`Firestore (${je}): ${t}`,...n)}}function Ge(t,...e){if(qe.logLevel<=ot.ERROR){const n=e.map(Ke);qe.error(`Firestore (${je}): ${t}`,...n)}}function He(t,...e){if(qe.logLevel<=ot.WARN){const n=e.map(Ke);qe.warn(`Firestore (${je}): ${t}`,...n)}}function Ke(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Qe(t,e,n){let r="Unexpected state";"string"==typeof e?r=e:n=e,We(t,r,n)}function We(t,e,n){let r=`FIRESTORE (${je}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(t){r+=" CONTEXT: "+n}throw Ge(r),new Error(r)}function Xe(t,e,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,t||We(e,i,r)}function Ye(t,e){return t}const Je={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ze extends W{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class tn{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class en{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class nn{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Be.UNAUTHENTICATED)))}shutdown(){}}class rn{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class sn{constructor(t){this.t=t,this.currentUser=Be.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Xe(void 0===this.o,42304);let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new tn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new tn,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{$e("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):($e("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new tn)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?($e("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Xe("string"==typeof e.accessToken,31837,{l:e}),new en(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Xe(null===t||"string"==typeof t,2055,{h:t}),new Be(t)}}class on{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=Be.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class an{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new on(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(Be.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class cn{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class un{constructor(t,e){var n;this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,null!=(n=t)&&void 0!==n.settings&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){Xe(void 0===this.o,3512);const n=t=>{null!=t.error&&$e("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.m;return this.m=t.token,$e("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{$e("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.V.getImmediate({optional:!0});t?r(t):$e("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new cn(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Xe("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new cn(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function ln(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class hn{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=ln(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function dn(t,e){return t<e?-1:t>e?1:0}function fn(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.charAt(r),i=e.charAt(r);if(n!==i)return gn(n)===gn(i)?dn(n,i):gn(n)?1:-1}return dn(t.length,e.length)}const mn=55296,pn=57343;function gn(t){const e=t.charCodeAt(0);return e>=mn&&e<=pn}function yn(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}const wn="__name__";class vn{constructor(t,e,n){void 0===e?e=0:e>t.length&&Qe(637,{offset:e,range:t.length}),void 0===n?n=t.length-e:n>t.length-e&&Qe(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===vn.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof vn?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=vn.compareSegments(t.get(r),e.get(r));if(0!==n)return n}return dn(t.length,e.length)}static compareSegments(t,e){const n=vn.isNumericId(t),r=vn.isNumericId(e);return n&&!r?-1:!n&&r?1:n&&r?vn.extractNumericId(t).compare(vn.extractNumericId(e)):fn(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Se.fromString(t.substring(4,t.length-2))}}class bn extends vn{construct(t,e,n){return new bn(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Ze(Je.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new bn(e)}static emptyPath(){return new bn([])}}const En=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class _n extends vn{construct(t,e,n){return new _n(t,e,n)}static isValidIdentifier(t){return En.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),_n.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===wn}static keyField(){return new _n([wn])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Ze(Je.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Ze(Je.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Ze(Je.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new Ze(Je.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new _n(e)}static emptyPath(){return new _n([])}}class Tn{constructor(t){this.path=t}static fromPath(t){return new Tn(bn.fromString(t))}static fromName(t){return new Tn(bn.fromString(t).popFirst(5))}static empty(){return new Tn(bn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===bn.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return bn.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Tn(new bn(t.slice()))}}function Sn(t,e,n){if(!n)throw new Ze(Je.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function In(t){if(!Tn.isDocumentKey(t))throw new Ze(Je.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Cn(t){if(Tn.isDocumentKey(t))throw new Ze(Je.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function An(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function xn(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Qe(12329,{type:typeof t})}function Dn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ze(Je.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=xn(t);throw new Ze(Je.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function kn(t,e){const n={typeString:t};return e&&(n.value=e),n}function Nn(t,e){if(!An(t))throw new Ze(Je.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const o=t[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&o!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new Ze(Je.INVALID_ARGUMENT,n);return!0}const Rn=-62135596800,On=1e6;class Ln{static now(){return Ln.fromMillis(Date.now())}static fromDate(t){return Ln.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*On);return new Ln(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ze(Je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ze(Je.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Rn)throw new Ze(Je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ze(Je.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/On}_compareTo(t){return this.seconds===t.seconds?dn(this.nanoseconds,t.nanoseconds):dn(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ln._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Nn(t,Ln._jsonSchema))return new Ln(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-Rn;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ln._jsonSchemaVersion="firestore/timestamp/1.0",Ln._jsonSchema={type:kn("string",Ln._jsonSchemaVersion),seconds:kn("number"),nanoseconds:kn("number")};class Mn{static fromTimestamp(t){return new Mn(t)}static min(){return new Mn(new Ln(0,0))}static max(){return new Mn(new Ln(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Pn(t){return new Vn(t.readTime,t.key,-1)}class Vn{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Vn(Mn.min(),Tn.empty(),-1)}static max(){return new Vn(Mn.max(),Tn.empty(),-1)}}function Fn(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=Tn.comparator(t.documentKey,e.documentKey),0!==n?n:dn(t.largestBatchId,e.largestBatchId))}class Un{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Bn(t){if(t.code!==Je.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;$e("LocalStore","Unexpectedly lost primary lease")}class jn{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Qe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new jn(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof jn?e:jn.resolve(e)}catch(t){return jn.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):jn.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):jn.reject(e)}static resolve(t){return new jn(((e,n)=>{e(t)}))}static reject(t){return new jn(((e,n)=>{n(t)}))}static waitFor(t){return new jn(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=jn.resolve(!1);for(const n of t)e=e.next((t=>t?jn.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new jn(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new jn(((n,r)=>{const i=()=>{!0===t()?e().next((()=>{i()}),r):n()};i()}))}}function qn(t){return"IndexedDbTransactionError"===t.name}class zn{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ae(t),this.ue=t=>e.writeSequenceNumber(t))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}zn.ce=-1;function $n(t){return null==t}function Gn(t){return 0===t&&1/t==-1/0}function Hn(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Kn(t){return t+""}const Qn="owner",Wn="mutationQueues",Xn="mutations",Yn="documentMutations",Jn="remoteDocumentGlobal",Zn="targets",tr="targetDocuments",er="targetGlobal",nr="collectionParents",rr="clientMetadata",ir="bundles",sr="namedQueries";function or(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ar(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function cr(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class ur{constructor(t,e){this.comparator=t,this.root=e||hr.EMPTY}insert(t,e){return new ur(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,hr.BLACK,null,null))}remove(t){return new ur(this.comparator,this.root.remove(t,this.comparator).copy(null,null,hr.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new lr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new lr(this.root,t,this.comparator,!1)}getReverseIterator(){return new lr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new lr(this.root,t,this.comparator,!0)}}class lr{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class hr{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:hr.RED,this.left=null!=r?r:hr.EMPTY,this.right=null!=i?i:hr.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new hr(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return hr.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return hr.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,hr.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,hr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Qe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Qe(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw Qe(27949);return t+(this.isRed()?0:1)}}hr.EMPTY=null,hr.RED=!0,hr.BLACK=!1,hr.EMPTY=new class{constructor(){this.size=0}get key(){throw Qe(57766)}get value(){throw Qe(16141)}get color(){throw Qe(16727)}get left(){throw Qe(29726)}get right(){throw Qe(36894)}copy(t,e,n,r,i){return this}insert(t,e,n){return new hr(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class dr{constructor(t){this.comparator=t,this.data=new ur(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new fr(this.data.getIterator())}getIteratorFrom(t){return new fr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof dr))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new dr(this.comparator);return e.data=t,e}}class fr{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class mr{constructor(t){this.fields=t,t.sort(_n.comparator)}static empty(){return new mr([])}unionWith(t){let e=new dr(_n.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new mr(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return yn(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class pr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class gr{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new pr("Invalid base64 string: "+t):t}}(t);return new gr(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new gr(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return dn(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}gr.EMPTY_BYTE_STRING=new gr("");const yr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function wr(t){if(Xe(!!t,39018),"string"==typeof t){let e=0;const n=yr.exec(t);if(Xe(!!n,46558,{timestamp:t}),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:vr(t.seconds),nanos:vr(t.nanos)}}function vr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function br(t){return"string"==typeof t?gr.fromBase64String(t):gr.fromUint8Array(t)}const Er="server_timestamp",_r="__type__",Tr="__previous_value__",Sr="__local_write_time__";function Ir(t){const e=(t?.mapValue?.fields||{})[_r]?.stringValue;return e===Er}function Cr(t){const e=t.mapValue.fields[Tr];return Ir(e)?Cr(e):e}function Ar(t){const e=wr(t.mapValue.fields[Sr].timestampValue);return new Ln(e.seconds,e.nanos)}class xr{constructor(t,e,n,r,i,s,o,a,c,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const Dr="(default)";class kr{constructor(t,e){this.projectId=t,this.database=e||Dr}static empty(){return new kr("","")}get isDefaultDatabase(){return this.database===Dr}isEqual(t){return t instanceof kr&&t.projectId===this.projectId&&t.database===this.database}}const Nr="__type__",Rr="__max__",Or={fields:{__type__:{stringValue:Rr}}},Lr="__vector__",Mr="value";function Pr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ir(t)?4:Zr(t)?9007199254740991:Yr(t)?10:11:Qe(28295,{value:t})}function Vr(t,e){if(t===e)return!0;const n=Pr(t);if(n!==Pr(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ar(t).isEqual(Ar(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=wr(t.timestampValue),r=wr(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return br(t.bytesValue).isEqual(br(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return vr(t.geoPointValue.latitude)===vr(e.geoPointValue.latitude)&&vr(t.geoPointValue.longitude)===vr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return vr(t.integerValue)===vr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=vr(t.doubleValue),r=vr(e.doubleValue);return n===r?Gn(n)===Gn(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return yn(t.arrayValue.values||[],e.arrayValue.values||[],Vr);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(or(n)!==or(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Vr(n[t],r[t])))return!1;return!0}(t,e);default:return Qe(52216,{left:t})}}function Fr(t,e){return void 0!==(t.values||[]).find((t=>Vr(t,e)))}function Ur(t,e){if(t===e)return 0;const n=Pr(t),r=Pr(e);if(n!==r)return dn(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return dn(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=vr(t.integerValue||t.doubleValue),r=vr(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Br(t.timestampValue,e.timestampValue);case 4:return Br(Ar(t),Ar(e));case 5:return fn(t.stringValue,e.stringValue);case 6:return function(t,e){const n=br(t),r=br(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=dn(n[t],r[t]);if(0!==e)return e}return dn(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=dn(vr(t.latitude),vr(e.latitude));return 0!==n?n:dn(vr(t.longitude),vr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return jr(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=e.fields||{},i=n[Mr]?.arrayValue,s=r[Mr]?.arrayValue,o=dn(i?.values?.length||0,s?.values?.length||0);return 0!==o?o:jr(i,s)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===Or&&e===Or)return 0;if(t===Or)return 1;if(e===Or)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=fn(r[t],s[t]);if(0!==e)return e;const o=Ur(n[r[t]],i[s[t]]);if(0!==o)return o}return dn(r.length,s.length)}(t.mapValue,e.mapValue);default:throw Qe(23264,{he:n})}}function Br(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return dn(t,e);const n=wr(t),r=wr(e),i=dn(n.seconds,r.seconds);return 0!==i?i:dn(n.nanos,r.nanos)}function jr(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Ur(n[t],r[t]);if(e)return e}return dn(n.length,r.length)}function qr(t){return zr(t)}function zr(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=wr(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return br(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return Tn.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=zr(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${zr(t.fields[i])}`;return n+"}"}(t.mapValue):Qe(61005,{value:t})}function $r(t){switch(Pr(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Cr(t);return e?16+$r(e):16;case 5:return 2*t.stringValue.length;case 6:return br(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(t){return(t.values||[]).reduce(((t,e)=>t+$r(e)),0)}(t.arrayValue);case 10:case 11:return function(t){let e=0;return ar(t.fields,((t,n)=>{e+=t.length+$r(n)})),e}(t.mapValue);default:throw Qe(13486,{value:t})}}function Gr(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Hr(t){return!!t&&"integerValue"in t}function Kr(t){return!!t&&"arrayValue"in t}function Qr(t){return!!t&&"nullValue"in t}function Wr(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Xr(t){return!!t&&"mapValue"in t}function Yr(t){const e=(t?.mapValue?.fields||{})[Nr]?.stringValue;return e===Lr}function Jr(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return ar(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Jr(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Jr(t.arrayValue.values[n]);return e}return{...t}}function Zr(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===Rr}class ti{constructor(t){this.value=t}static empty(){return new ti({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Xr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Jr(e)}setAll(t){let e=_n.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=Jr(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());Xr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Vr(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Xr(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){ar(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new ti(Jr(this.value))}}function ei(t){const e=[];return ar(t.fields,((t,n)=>{const r=new _n([t]);if(Xr(n)){const t=ei(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new mr(e)}class ni{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new ni(t,0,Mn.min(),Mn.min(),Mn.min(),ti.empty(),0)}static newFoundDocument(t,e,n,r){return new ni(t,1,e,Mn.min(),n,r,0)}static newNoDocument(t,e){return new ni(t,2,e,Mn.min(),Mn.min(),ti.empty(),0)}static newUnknownDocument(t,e){return new ni(t,3,e,Mn.min(),Mn.min(),ti.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Mn.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ti.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ti.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Mn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof ni&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ni(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ri{constructor(t,e){this.position=t,this.inclusive=e}}function ii(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?Tn.comparator(Tn.fromName(o.referenceValue),n.key):Ur(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function si(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Vr(t.position[n],e.position[n]))return!1;return!0}class oi{constructor(t,e="asc"){this.field=t,this.dir=e}}function ai(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ci{}class ui extends ci{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new gi(t,e,n):"array-contains"===e?new bi(t,n):"in"===e?new Ei(t,n):"not-in"===e?new _i(t,n):"array-contains-any"===e?new Ti(t,n):new ui(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new yi(t,n):new wi(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison(Ur(e,this.value)):null!==e&&Pr(this.value)===Pr(e)&&this.matchesComparison(Ur(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Qe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class li extends ci{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new li(t,e)}matches(t){return hi(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function hi(t){return"and"===t.op}function di(t){return function(t){for(const e of t.filters)if(e instanceof li)return!1;return!0}(t)&&hi(t)}function fi(t){if(t instanceof ui)return t.field.canonicalString()+t.op.toString()+qr(t.value);if(di(t))return t.filters.map((t=>fi(t))).join(",");{const e=t.filters.map((t=>fi(t))).join(",");return`${t.op}(${e})`}}function mi(t,e){return t instanceof ui?function(t,e){return e instanceof ui&&t.op===e.op&&t.field.isEqual(e.field)&&Vr(t.value,e.value)}(t,e):t instanceof li?function(t,e){return e instanceof li&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&mi(n,e.filters[r])),!0)}(t,e):void Qe(19439)}function pi(t){return t instanceof ui?function(t){return`${t.field.canonicalString()} ${t.op} ${qr(t.value)}`}(t):t instanceof li?function(t){return t.op.toString()+" {"+t.getFilters().map(pi).join(" ,")+"}"}(t):"Filter"}class gi extends ui{constructor(t,e,n){super(t,e,n),this.key=Tn.fromName(n.referenceValue)}matches(t){const e=Tn.comparator(t.key,this.key);return this.matchesComparison(e)}}class yi extends ui{constructor(t,e){super(t,"in",e),this.keys=vi(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class wi extends ui{constructor(t,e){super(t,"not-in",e),this.keys=vi(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function vi(t,e){return(e.arrayValue?.values||[]).map((t=>Tn.fromName(t.referenceValue)))}class bi extends ui{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Kr(e)&&Fr(e.arrayValue,this.value)}}class Ei extends ui{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Fr(this.value.arrayValue,e)}}class _i extends ui{constructor(t,e){super(t,"not-in",e)}matches(t){if(Fr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&void 0===e.nullValue&&!Fr(this.value.arrayValue,e)}}class Ti extends ui{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Kr(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Fr(this.value.arrayValue,t)))}}class Si{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Te=null}}function Ii(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Si(t,e,n,r,i,s,o)}function Ci(t){const e=Ye(t);if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>fi(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),$n(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>qr(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>qr(t))).join(",")),e.Te=t}return e.Te}function Ai(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ai(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!mi(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!si(t.startAt,e.startAt)&&si(t.endAt,e.endAt)}function xi(t){return Tn.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Di{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function ki(t){return new Di(t)}function Ni(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Ri(t){return null!==t.collectionGroup}function Oi(t){const e=Ye(t);if(null===e.Ie){e.Ie=[];const t=new Set;for(const n of e.explicitOrderBy)e.Ie.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new dr(_n.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ie.push(new oi(r,n))})),t.has(_n.keyField().canonicalString())||e.Ie.push(new oi(_n.keyField(),n))}return e.Ie}function Li(t){const e=Ye(t);return e.Ee||(e.Ee=function(t,e){if("F"===t.limitType)return Ii(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new oi(t.field,e)}));const n=t.endAt?new ri(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new ri(t.startAt.position,t.startAt.inclusive):null;return Ii(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,Oi(t))),e.Ee}function Mi(t,e){const n=t.filters.concat([e]);return new Di(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Pi(t,e,n){return new Di(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Vi(t,e){return Ai(Li(t),Li(e))&&t.limitType===e.limitType}function Fi(t){return`${Ci(Li(t))}|lt:${t.limitType}`}function Ui(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>pi(t))).join(", ")}]`),$n(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>qr(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>qr(t))).join(",")),`Target(${e})`}(Li(t))}; limitType=${t.limitType})`}function Bi(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Tn.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Oi(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=ii(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Oi(t),e)||t.endAt&&!function(t,e,n){const r=ii(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Oi(t),e))}(t,e)}function ji(t){return(e,n)=>{let r=!1;for(const i of Oi(t)){const t=qi(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function qi(t,e,n){const r=t.field.isKeyField()?Tn.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Ur(r,i):Qe(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Qe(19790,{direction:t.dir})}}class zi{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){ar(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return cr(this.inner)}size(){return this.innerSize}}const $i=new ur(Tn.comparator);function Gi(){return $i}const Hi=new ur(Tn.comparator);function Ki(...t){let e=Hi;for(const n of t)e=e.insert(n.key,n);return e}function Qi(t){let e=Hi;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Wi(){return Yi()}function Xi(){return Yi()}function Yi(){return new zi((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Ji=new ur(Tn.comparator),Zi=new dr(Tn.comparator);function ts(...t){let e=Zi;for(const n of t)e=e.add(n);return e}const es=new dr(dn);function ns(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Gn(e)?"-0":e}}function rs(t){return{integerValue:""+t}}function is(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Gn(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?rs(e):ns(t,e)}class ss{constructor(){this._=void 0}}function os(t,e,n){return t instanceof us?function(t,e){const n={fields:{[_r]:{stringValue:Er},[Sr]:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ir(e)&&(e=Cr(e)),e&&(n.fields[Tr]=e),{mapValue:n}}(n,e):t instanceof ls?hs(t,e):t instanceof ds?fs(t,e):function(t,e){const n=cs(t,e),r=ps(n)+ps(t.Ae);return Hr(n)&&Hr(t.Ae)?rs(r):ns(t.serializer,r)}(t,e)}function as(t,e,n){return t instanceof ls?hs(t,e):t instanceof ds?fs(t,e):n}function cs(t,e){return t instanceof ms?function(t){return Hr(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class us extends ss{}class ls extends ss{constructor(t){super(),this.elements=t}}function hs(t,e){const n=gs(e);for(const e of t.elements)n.some((t=>Vr(t,e)))||n.push(e);return{arrayValue:{values:n}}}class ds extends ss{constructor(t){super(),this.elements=t}}function fs(t,e){let n=gs(e);for(const e of t.elements)n=n.filter((t=>!Vr(t,e)));return{arrayValue:{values:n}}}class ms extends ss{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function ps(t){return vr(t.integerValue||t.doubleValue)}function gs(t){return Kr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class ys{constructor(t,e){this.field=t,this.transform=e}}class ws{constructor(t,e){this.version=t,this.transformResults=e}}class vs{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new vs}static exists(t){return new vs(void 0,t)}static updateTime(t){return new vs(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function bs(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Es{}function _s(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Rs(t.key,vs.none()):new As(t.key,t.data,vs.none());{const n=t.data,r=ti.empty();let i=new dr(_n.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new xs(t.key,r,new mr(i.toArray()),vs.none())}}function Ts(t,e,n){t instanceof As?function(t,e,n){const r=t.value.clone(),i=ks(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof xs?function(t,e,n){if(!bs(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=ks(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Ds(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ss(t,e,n,r){return t instanceof As?function(t,e,n,r){if(!bs(t.precondition,e))return n;const i=t.value.clone(),s=Ns(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof xs?function(t,e,n,r){if(!bs(t.precondition,e))return n;const i=Ns(t.fieldTransforms,r,e),s=e.data;return s.setAll(Ds(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return bs(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Is(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=cs(r.transform,t||null);null!=i&&(null===n&&(n=ti.empty()),n.set(r.field,i))}return n||null}function Cs(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&yn(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ls&&e instanceof ls||t instanceof ds&&e instanceof ds?yn(t.elements,e.elements,Vr):t instanceof ms&&e instanceof ms?Vr(t.Ae,e.Ae):t instanceof us&&e instanceof us}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class As extends Es{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class xs extends Es{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ds(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function ks(t,e,n){const r=new Map;Xe(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,as(o,a,n[i]))}return r}function Ns(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,os(t,s,e))}return r}class Rs extends Es{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Os extends Es{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ls{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Ts(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Ss(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Ss(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Xi();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=_s(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Mn.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ts())}isEqual(t){return this.batchId===t.batchId&&yn(this.mutations,t.mutations,((t,e)=>Cs(t,e)))&&yn(this.baseMutations,t.baseMutations,((t,e)=>Cs(t,e)))}}class Ms{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Xe(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let r=Ji;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new Ms(t,e,n,r)}}class Ps{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Vs{constructor(t,e){this.count=t,this.unchangedNames=e}}var Fs,Us;function Bs(t){if(void 0===t)return Ge("GRPC error has no .code"),Je.UNKNOWN;switch(t){case Fs.OK:return Je.OK;case Fs.CANCELLED:return Je.CANCELLED;case Fs.UNKNOWN:return Je.UNKNOWN;case Fs.DEADLINE_EXCEEDED:return Je.DEADLINE_EXCEEDED;case Fs.RESOURCE_EXHAUSTED:return Je.RESOURCE_EXHAUSTED;case Fs.INTERNAL:return Je.INTERNAL;case Fs.UNAVAILABLE:return Je.UNAVAILABLE;case Fs.UNAUTHENTICATED:return Je.UNAUTHENTICATED;case Fs.INVALID_ARGUMENT:return Je.INVALID_ARGUMENT;case Fs.NOT_FOUND:return Je.NOT_FOUND;case Fs.ALREADY_EXISTS:return Je.ALREADY_EXISTS;case Fs.PERMISSION_DENIED:return Je.PERMISSION_DENIED;case Fs.FAILED_PRECONDITION:return Je.FAILED_PRECONDITION;case Fs.ABORTED:return Je.ABORTED;case Fs.OUT_OF_RANGE:return Je.OUT_OF_RANGE;case Fs.UNIMPLEMENTED:return Je.UNIMPLEMENTED;case Fs.DATA_LOSS:return Je.DATA_LOSS;default:return Qe(39323,{code:t})}}(Us=Fs||(Fs={}))[Us.OK=0]="OK",Us[Us.CANCELLED=1]="CANCELLED",Us[Us.UNKNOWN=2]="UNKNOWN",Us[Us.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Us[Us.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Us[Us.NOT_FOUND=5]="NOT_FOUND",Us[Us.ALREADY_EXISTS=6]="ALREADY_EXISTS",Us[Us.PERMISSION_DENIED=7]="PERMISSION_DENIED",Us[Us.UNAUTHENTICATED=16]="UNAUTHENTICATED",Us[Us.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Us[Us.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Us[Us.ABORTED=10]="ABORTED",Us[Us.OUT_OF_RANGE=11]="OUT_OF_RANGE",Us[Us.UNIMPLEMENTED=12]="UNIMPLEMENTED",Us[Us.INTERNAL=13]="INTERNAL",Us[Us.UNAVAILABLE=14]="UNAVAILABLE",Us[Us.DATA_LOSS=15]="DATA_LOSS";const js=new Se([4294967295,4294967295],0);function qs(t){const e=(new TextEncoder).encode(t),n=new Ie;return n.update(e),new Uint8Array(n.digest())}function zs(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Se([n,r],0),new Se([i,s],0)]}class $s{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Gs(`Invalid padding: ${e}`);if(n<0)throw new Gs(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Gs(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Gs(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=Se.fromNumber(this.ge)}ye(t,e,n){let r=t.add(e.multiply(Se.fromNumber(n)));return 1===r.compare(js)&&(r=new Se([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.ge)return!1;const e=qs(t),[n,r]=zs(e);for(let t=0;t<this.hashCount;t++){const e=this.ye(n,r,t);if(!this.we(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new $s(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.ge)return;const e=qs(t),[n,r]=zs(e);for(let t=0;t<this.hashCount;t++){const e=this.ye(n,r,t);this.Se(e)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Gs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Hs{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Ks.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Hs(Mn.min(),r,new ur(dn),Gi(),ts())}}class Ks{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Ks(n,e,ts(),ts(),ts())}}class Qs{constructor(t,e,n,r){this.be=t,this.removedTargetIds=e,this.key=n,this.De=r}}class Ws{constructor(t,e){this.targetId=t,this.Ce=e}}class Xs{constructor(t,e,n=gr.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Ys{constructor(){this.ve=0,this.Fe=to(),this.Me=gr.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=ts(),e=ts(),n=ts();return this.Fe.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Qe(38017,{changeType:i})}})),new Ks(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=to()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,Xe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Js{constructor(t){this.Ge=t,this.ze=new Map,this.je=Gi(),this.Je=Zs(),this.He=Zs(),this.Ye=new ur(dn)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:Qe(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((t,n)=>{this.rt(n)&&e(n)}))}st(t){const e=t.targetId,n=t.Ce.count,r=this.ot(e);if(r){const i=r.target;if(xi(i))if(0===n){const t=new Tn(i.path);this.et(e,t,ni.newNoDocument(t,Mn.min()))}else Xe(1===n,20013,{expectedCount:n});else{const r=this._t(e);if(r!==n){const n=this.ut(t),i=n?this.ct(n,t,r):1;if(0!==i){this.it(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,t)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=br(n).toUint8Array()}catch(t){if(t instanceof pr)return He("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new $s(s,r,i)}catch(t){return He(t instanceof Gs?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.ge?null:o}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.et(e,n,null),r++)})),r}Tt(t){const e=new Map;this.ze.forEach(((n,r)=>{const i=this.ot(r);if(i){if(n.current&&xi(i.target)){const e=new Tn(i.target.path);this.It(e).has(r)||this.Et(r,e)||this.et(r,e,ni.newNoDocument(e,t))}n.Be&&(e.set(r,n.ke()),n.qe())}}));let n=ts();this.He.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.ot(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.je.forEach(((e,n)=>n.setReadTime(t)));const r=new Hs(t,e,this.Ye,this.je,n);return this.je=Gi(),this.Je=Zs(),this.He=Zs(),this.Ye=new ur(dn),r}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const r=this.nt(t);this.Et(t,e)?r.Qe(e,1):r.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new Ys,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new dr(dn),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new dr(dn),this.Je=this.Je.insert(t,e)),e}rt(t){const e=null!==this.ot(t);return e||$e("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new Ys),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Zs(){return new ur(Tn.comparator)}function to(){return new ur(Tn.comparator)}const eo={asc:"ASCENDING",desc:"DESCENDING"},no={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ro={and:"AND",or:"OR"};class io{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function so(t,e){return t.useProto3Json||$n(e)?e:{value:e}}function oo(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ao(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function co(t,e){return oo(t,e.toTimestamp())}function uo(t){return Xe(!!t,49232),Mn.fromTimestamp(function(t){const e=wr(t);return new Ln(e.seconds,e.nanos)}(t))}function lo(t,e){return ho(t,e).canonicalString()}function ho(t,e){const n=function(t){return new bn(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function fo(t){const e=bn.fromString(t);return Xe(No(e),10190,{key:e.toString()}),e}function mo(t,e){return lo(t.databaseId,e.path)}function po(t,e){const n=fo(e);if(n.get(1)!==t.databaseId.projectId)throw new Ze(Je.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ze(Je.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Tn(wo(n))}function go(t,e){return lo(t.databaseId,e)}function yo(t){return new bn(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function wo(t){return Xe(t.length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5)}function vo(t,e,n){return{name:mo(t,e),fields:n.value.mapValue.fields}}function bo(t,e){return{documents:[go(t,e.path)]}}function Eo(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=go(t,i);const s=function(t){if(0!==t.length)return Do(li.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Ao(t.field),direction:So(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=so(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ft:n,parent:i}}function _o(t){let e=function(t){const e=fo(t);return 4===e.length?bn.emptyPath():wo(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Xe(1===r,65062);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=To(t);return e instanceof li&&di(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new oi(xo(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,$n(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new ri(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new ri(n,e)}(n.endAt)),function(t,e,n,r,i,s,o,a){return new Di(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,u)}function To(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=xo(t.unaryFilter.field);return ui.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=xo(t.unaryFilter.field);return ui.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=xo(t.unaryFilter.field);return ui.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=xo(t.unaryFilter.field);return ui.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Qe(61313);default:return Qe(60726)}}(t):void 0!==t.fieldFilter?function(t){return ui.create(xo(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Qe(58110);default:return Qe(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return li.create(t.compositeFilter.filters.map((t=>To(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Qe(1026)}}(t.compositeFilter.op))}(t):Qe(30097,{filter:t})}function So(t){return eo[t]}function Io(t){return no[t]}function Co(t){return ro[t]}function Ao(t){return{fieldPath:t.canonicalString()}}function xo(t){return _n.fromServerFormat(t.fieldPath)}function Do(t){return t instanceof ui?function(t){if("=="===t.op){if(Wr(t.value))return{unaryFilter:{field:Ao(t.field),op:"IS_NAN"}};if(Qr(t.value))return{unaryFilter:{field:Ao(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Wr(t.value))return{unaryFilter:{field:Ao(t.field),op:"IS_NOT_NAN"}};if(Qr(t.value))return{unaryFilter:{field:Ao(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ao(t.field),op:Io(t.op),value:t.value}}}(t):t instanceof li?function(t){const e=t.getFilters().map((t=>Do(t)));return 1===e.length?e[0]:{compositeFilter:{op:Co(t.op),filters:e}}}(t):Qe(54877,{filter:t})}function ko(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function No(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Ro{constructor(t,e,n,r,i=Mn.min(),s=Mn.min(),o=gr.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Ro(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Ro(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Ro(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Ro(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Oo{constructor(t){this.yt=t}}function Lo(t){const e=_o({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Pi(e,e.limit,"L"):e}class Mo{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(vr(t.integerValue));else if("doubleValue"in t){const n=vr(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),Gn(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),"string"==typeof n&&(n=wr(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(br(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?Zr(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):Yr(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):Qe(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){const n=t.fields||{};this.Ft(e,55);for(const t of Object.keys(n))this.Ot(t,e),this.Ct(n[t],e)}kt(t,e){const n=t.fields||{};this.Ft(e,53);const r=Mr,i=n[r].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(vr(i)),this.Ot(r,e),this.Ct(n[r],e)}Qt(t,e){const n=t.values||[];this.Ft(e,50);for(const t of n)this.Ct(t,e)}Lt(t,e){this.Ft(e,37),Tn.fromName(t).path.forEach((t=>{this.Ft(e,60),this.Ut(t,e)}))}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}Mo.Kt=new Mo;class Po{constructor(){this.Cn=new Vo}addToCollectionParentIndex(t,e){return this.Cn.add(e),jn.resolve()}getCollectionParents(t,e){return jn.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return jn.resolve()}deleteFieldIndex(t,e){return jn.resolve()}deleteAllFieldIndexes(t){return jn.resolve()}createTargetIndexes(t,e){return jn.resolve()}getDocumentsMatchingTarget(t,e){return jn.resolve(null)}getIndexType(t,e){return jn.resolve(0)}getFieldIndexes(t,e){return jn.resolve([])}getNextCollectionGroupToUpdate(t){return jn.resolve(null)}getMinOffset(t,e){return jn.resolve(Vn.min())}getMinOffsetFromCollectionGroup(t,e){return jn.resolve(Vn.min())}updateCollectionGroup(t,e,n){return jn.resolve()}updateIndexEntries(t,e){return jn.resolve()}}class Vo{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new dr(bn.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new dr(bn.comparator)).toArray()}}new Uint8Array(0);const Fo={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Uo=41943040;class Bo{static withCacheSize(t){return new Bo(t,Bo.DEFAULT_COLLECTION_PERCENTILE,Bo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}Bo.DEFAULT_COLLECTION_PERCENTILE=10,Bo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bo.DEFAULT=new Bo(Uo,Bo.DEFAULT_COLLECTION_PERCENTILE,Bo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bo.DISABLED=new Bo(-1,0,0);class jo{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new jo(0)}static cr(){return new jo(-1)}}const qo="LruGarbageCollector";function zo([t,e],[n,r]){const i=dn(t,n);return 0===i?dn(e,r):i}class $o{constructor(t){this.Ir=t,this.buffer=new dr(zo),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();zo(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Go{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(t){$e(qo,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){qn(t)?$e(qo,"Ignoring IndexedDB error during garbage collection: ",t):await Bn(t)}await this.Vr(3e5)}))}}class Ho{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return jn.resolve(zn.ce);const n=new $o(e);return this.mr.forEachTarget(t,(t=>n.Ar(t.sequenceNumber))).next((()=>this.mr.pr(t,(t=>n.Ar(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?($e("LruGarbageCollector","Garbage collection skipped; disabled"),jn.resolve(Fo)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?($e("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Fo):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?($e("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(c=Date.now(),ze()<=ot.DEBUG&&$e("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),jn.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t}))))}}class Ko{constructor(){this.changes=new zi((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ni.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?jn.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Qo{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Wo{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Ss(n.mutation,t,mr.empty(),Ln.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ts()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=ts()){const r=Wi();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=Ki();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Wi();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ts())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=Gi();const s=Yi(),o=Yi();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof xs)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Ss(o.mutation,e,o.mutation.getFieldMask(),Ln.now())):s.set(e.key,mr.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>o.set(t,new Qo(e,s.get(t)??null)))),o)))}recalculateAndSaveOverlays(t,e){const n=Yi();let r=new ur(((t,e)=>t-e)),i=ts();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||mr.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||ts()).add(t);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Xi();c.forEach((t=>{if(!i.has(t)){const r=_s(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return jn.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return Tn.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Ri(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):jn.resolve(Wi());let o=-1,a=i;return s.next((e=>jn.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?jn.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,ts()))).next((t=>({batchId:o,changes:Qi(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Tn(e)).next((t=>{let e=Ki();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=Ki();return this.indexManager.getCollectionParents(t,i).next((o=>jn.forEach(o,(o=>{const a=function(t,e){return new Di(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r)))).next((t=>{i.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,ni.newInvalidDocument(r)))}));let n=Ki();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&Ss(s.mutation,r,mr.empty(),Ln.now()),Bi(e,r)&&(n=n.insert(t,r))})),n}))}}class Xo{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return jn.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:uo(t.createTime)}}(e)),jn.resolve()}getNamedQuery(t,e){return jn.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(t){return{name:t.name,query:Lo(t.bundledQuery),readTime:uo(t.readTime)}}(e)),jn.resolve()}}class Yo{constructor(){this.overlays=new ur(Tn.comparator),this.qr=new Map}getOverlay(t,e){return jn.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Wi();return jn.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.St(t,e,r)})),jn.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.qr.delete(n)),jn.resolve()}getOverlaysForCollection(t,e,n){const r=Wi(),i=e.length+1,s=new Tn(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return jn.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new ur(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Wi(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Wi(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return jn.resolve(o)}St(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Ps(e,n));let i=this.qr.get(e);void 0===i&&(i=ts(),this.qr.set(e,i)),this.qr.set(e,i.add(n.key))}}class Jo{constructor(){this.sessionToken=gr.EMPTY_BYTE_STRING}getSessionToken(t){return jn.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,jn.resolve()}}class Zo{constructor(){this.Qr=new dr(ta.$r),this.Ur=new dr(ta.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new ta(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Gr(new ta(t,e))}zr(t,e){t.forEach((t=>this.removeReference(t,e)))}jr(t){const e=new Tn(new bn([])),n=new ta(e,t),r=new ta(e,t+1),i=[];return this.Ur.forEachInRange([n,r],(t=>{this.Gr(t),i.push(t.key)})),i}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new Tn(new bn([])),n=new ta(e,t),r=new ta(e,t+1);let i=ts();return this.Ur.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new ta(t,0),n=this.Qr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class ta{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return Tn.comparator(t.key,e.key)||dn(t.Yr,e.Yr)}static Kr(t,e){return dn(t.Yr,e.Yr)||Tn.comparator(t.key,e.key)}}class ea{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new dr(ta.$r)}checkEmpty(t){return jn.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ls(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.Zr=this.Zr.add(new ta(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return jn.resolve(s)}lookupMutationBatch(t,e){return jn.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.ei(n),i=r<0?0:r;return jn.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return jn.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(t){return jn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new ta(e,0),r=new ta(e,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,r],(t=>{const e=this.Xr(t.Yr);i.push(e)})),jn.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new dr(dn);return e.forEach((t=>{const e=new ta(t,0),r=new ta(t,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([e,r],(t=>{n=n.add(t.Yr)}))})),jn.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;Tn.isDocumentKey(i)||(i=i.child(""));const s=new ta(new Tn(i),0);let o=new dr(dn);return this.Zr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.Yr)),!0)}),s),jn.resolve(this.ti(o))}ti(t){const e=[];return t.forEach((t=>{const n=this.Xr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Xe(0===this.ni(e.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return jn.forEach(e.mutations,(r=>{const i=new ta(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.Zr=n}))}ir(t){}containsKey(t,e){const n=new ta(e,0),r=this.Zr.firstAfterOrEqual(n);return jn.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,jn.resolve()}ni(t,e){return this.ei(t)}ei(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class na{constructor(t){this.ri=t,this.docs=new ur(Tn.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return jn.resolve(n?n.document.mutableCopy():ni.newInvalidDocument(e))}getEntries(t,e){let n=Gi();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():ni.newInvalidDocument(t))})),jn.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=Gi();const s=e.path,o=new Tn(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||Fn(Pn(o),n)<=0||(r.has(o.key)||Bi(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return jn.resolve(i)}getAllFromCollectionGroup(t,e,n,r){Qe(9500)}ii(t,e){return jn.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new ra(this)}getSize(t){return jn.resolve(this.size)}}class ra extends Ko{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.Nr.addEntry(t,r)):this.Nr.removeEntry(n)})),jn.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class ia{constructor(t){this.persistence=t,this.si=new zi((t=>Ci(t)),Ai),this.lastRemoteSnapshotVersion=Mn.min(),this.highestTargetId=0,this.oi=0,this._i=new Zo,this.targetCount=0,this.ai=jo.ur()}forEachTarget(t,e){return this.si.forEach(((t,n)=>e(n))),jn.resolve()}getLastRemoteSnapshotVersion(t){return jn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return jn.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),jn.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),jn.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new jo(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,jn.resolve()}updateTargetData(t,e){return this.Pr(e),jn.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,jn.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.si.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),jn.waitFor(i).next((()=>r))}getTargetCount(t){return jn.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return jn.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),jn.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),jn.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),jn.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return jn.resolve(n)}containsKey(t,e){return jn.resolve(this._i.containsKey(e))}}class sa{constructor(t,e){this.ui={},this.overlays={},this.ci=new zn(0),this.li=!1,this.li=!0,this.hi=new Jo,this.referenceDelegate=t(this),this.Pi=new ia(this),this.indexManager=new Po,this.remoteDocumentCache=function(t){return new na(t)}((t=>this.referenceDelegate.Ti(t))),this.serializer=new Oo(e),this.Ii=new Xo(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Yo,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new ea(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){$e("MemoryPersistence","Starting transaction:",t);const r=new oa(this.ci.next());return this.referenceDelegate.Ei(),n(r).next((t=>this.referenceDelegate.di(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Ai(t,e){return jn.or(Object.values(this.ui).map((n=>()=>n.containsKey(t,e))))}}class oa extends Un{constructor(t){super(),this.currentSequenceNumber=t}}class aa{constructor(t){this.persistence=t,this.Ri=new Zo,this.Vi=null}static mi(t){return new aa(t)}get fi(){if(this.Vi)return this.Vi;throw Qe(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),jn.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),jn.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),jn.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((t=>this.fi.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.fi.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return jn.forEach(this.fi,(n=>{const r=Tn.fromPath(n);return this.gi(t,r).next((t=>{t||e.removeEntry(r,Mn.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((t=>{t?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return jn.or([()=>jn.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class ca{constructor(t,e){this.persistence=t,this.pi=new zi((t=>function(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Kn(e)),e=Hn(t.get(n),e);return Kn(e)}(t.path)),((t,e)=>t.isEqual(e))),this.garbageCollector=function(t,e){return new Ho(t,e)}(this,e)}static mi(t,e){return new ca(t,e)}Ei(){}di(t){return jn.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}wr(t){let e=0;return this.pr(t,(t=>{e++})).next((()=>e))}pr(t,e){return jn.forEach(this.pi,((n,r)=>this.br(t,n,r).next((t=>t?jn.resolve():e(r)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(t,(r=>this.br(t,r,e).next((t=>{t||(n++,i.removeEntry(r,Mn.min()))})))).next((()=>i.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),jn.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),jn.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),jn.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),jn.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=$r(t.data.value)),e}br(t,e,n){return jn.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.pi.get(e);return jn.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class ua{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=r}static As(t,e){let n=ts(),r=ts();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new ua(t,e.fromCache,n,r)}}class la{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class ha{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=Q()?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.ys(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.ws(t,e,r,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new la;return this.Ss(t,e,n).next((r=>{if(i.result=r,this.Vs)return this.bs(t,e,n,r.size)}))})).next((()=>i.result))}bs(t,e,n,r){return n.documentReadCount<this.fs?(ze()<=ot.DEBUG&&$e("QueryEngine","SDK will not create cache indexes for query:",Ui(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),jn.resolve()):(ze()<=ot.DEBUG&&$e("QueryEngine","Query:",Ui(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(ze()<=ot.DEBUG&&$e("QueryEngine","The SDK decides to create cache indexes for query:",Ui(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Li(e))):jn.resolve())}ys(t,e){if(Ni(e))return jn.resolve(null);let n=Li(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Pi(e,null,"F"),n=Li(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=ts(...r);return this.ps.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Ds(e,r);return this.Cs(e,s,i,n.readTime)?this.ys(t,Pi(e,null,"F")):this.vs(t,s,e,n)}))))})))))}ws(t,e,n,r){return Ni(e)||r.isEqual(Mn.min())?jn.resolve(null):this.ps.getDocuments(t,n).next((i=>{const s=this.Ds(e,i);return this.Cs(e,s,n,r)?jn.resolve(null):(ze()<=ot.DEBUG&&$e("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Ui(e)),this.vs(t,s,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Mn.fromTimestamp(1e9===r?new Ln(n+1,0):new Ln(n,r));return new Vn(i,Tn.empty(),e)}(r,-1)).next((t=>t)))}))}Ds(t,e){let n=new dr(ji(t));return e.forEach(((e,r)=>{Bi(t,r)&&(n=n.add(r))})),n}Cs(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(t,e,n){return ze()<=ot.DEBUG&&$e("QueryEngine","Using full collection scan to execute query:",Ui(e)),this.ps.getDocumentsMatchingQuery(t,e,Vn.min(),n)}vs(t,e,n,r){return this.ps.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}const da="LocalStore";class fa{constructor(t,e,n,r){this.persistence=t,this.Fs=e,this.serializer=r,this.Ms=new ur(dn),this.xs=new zi((t=>Ci(t)),Ai),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Wo(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}async function ma(t,e){const n=Ye(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n.Bs(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=ts();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({Ls:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function pa(t){const e=Ye(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function ga(t,e){const n=Ye(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function ya(t,e,n){const r=Ye(t),i=r.Ms.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!qn(t))throw t;$e(da,`Failed to update sequence numbers for target ${e}: ${t}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function wa(t,e,n){const r=Ye(t);let i=Mn.min(),s=ts();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=Ye(t),i=r.xs.get(n);return void 0!==i?jn.resolve(r.Ms.get(i)):r.Pi.getTargetData(e,n)}(r,t,Li(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.Fs.getDocumentsMatchingQuery(t,e,n?i:Mn.min(),n?s:ts()))).next((t=>(function(t,e,n){let r=t.Os.get(e)||Mn.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.Os.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,Qs:s})))))}class va{constructor(){this.activeTargetIds=es}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ba{constructor(){this.Mo=new va,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new va,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Ea{Oo(t){}shutdown(){}}const _a="ConnectivityMonitor";class Ta{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){$e(_a,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){$e(_a,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Sa=null;function Ia(){return null===Sa?Sa=268435456+Math.round(2147483648*Math.random()):Sa++,"0x"+Sa.toString(16)}const Ca="RestConnection",Aa={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xa{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===Dr?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(t,e,n,r,i){const s=Ia(),o=this.zo(t,e.toUriEncodedString());$e(Ca,`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,i);const{host:c}=new URL(o),u=$(c);return this.Jo(t,o,a,n,u).then((e=>($e(Ca,`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw He(Ca,`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}Ho(t,e,n,r,i,s){return this.Go(t,e,n,r,i)}jo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+je,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}zo(t,e){const n=Aa[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}}class Da{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const ka="WebChannelConnection";class Na extends xa{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,r,i){const s=Ia();return new Promise(((i,o)=>{const a=new xe;a.setWithCredentials(!0),a.listenOnce(ke.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Ne.NO_ERROR:const e=a.getResponseJson();$e(ka,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case Ne.TIMEOUT:$e(ka,`RPC '${t}' ${s} timed out`),o(new Ze(Je.DEADLINE_EXCEEDED,"Request time out"));break;case Ne.HTTP_ERROR:const n=a.getStatus();if($e(ka,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=t?.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Je).indexOf(e)>=0?e:Je.UNKNOWN}(e.status);o(new Ze(t,e.message))}else o(new Ze(Je.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Ze(Je.UNAVAILABLE,"Connection failed."));break;default:Qe(9055,{l_:t,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{$e(ka,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(r);$e(ka,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",c,n,15)}))}T_(t,e,n){const r=Ia(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Me(),o=Le(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=i.join("");$e(ka,`Creating RPC '${t}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);this.I_(l);let h=!1,d=!1;const f=new Da({Yo:e=>{d?$e(ka,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(h||($e(ka,`Opening RPC '${t}' stream ${r} transport.`),l.open(),h=!0),$e(ka,`RPC '${t}' stream ${r} sending:`,e),l.send(e))},Zo:()=>l.close()}),m=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return m(l,De.EventType.OPEN,(()=>{d||($e(ka,`RPC '${t}' stream ${r} transport opened.`),f.o_())})),m(l,De.EventType.CLOSE,(()=>{d||(d=!0,$e(ka,`RPC '${t}' stream ${r} transport closed`),f.a_(),this.E_(l))})),m(l,De.EventType.ERROR,(e=>{d||(d=!0,He(ka,`RPC '${t}' stream ${r} transport errored. Name:`,e.name,"Message:",e.message),f.a_(new Ze(Je.UNAVAILABLE,"The operation could not be completed")))})),m(l,De.EventType.MESSAGE,(e=>{if(!d){const n=e.data[0];Xe(!!n,16349);const i=n,s=i?.error||i[0]?.error;if(s){$e(ka,`RPC '${t}' stream ${r} received error:`,s);const e=s.status;let n=function(t){const e=Fs[t];if(void 0!==e)return Bs(e)}(e),i=s.message;void 0===n&&(n=Je.INTERNAL,i="Unknown error status: "+e+" with message "+s.message),d=!0,f.a_(new Ze(n,i)),l.close()}else $e(ka,`RPC '${t}' stream ${r} received:`,n),f.u_(n)}})),m(o,Oe.STAT_EVENT,(e=>{e.stat===Re.PROXY?$e(ka,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Re.NOPROXY&&$e(ka,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.__()}),0),f}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function Ra(){return"undefined"!=typeof document?document:null}function Oa(t){return new io(t,!0)}class La{constructor(t,e,n=1e3,r=1.5,i=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,e-n);r>0&&$e("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Ma="PersistentStream";class Pa{constructor(t,e,n,r,i,s,o,a){this.Mi=t,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new La(t,e)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==t?this.M_.reset():e&&e.code===Je.RESOURCE_EXHAUSTED?(Ge(e.toString()),Ge("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===Je.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.D_===e&&this.G_(t,n)}),(e=>{t((()=>{const t=new Ze(Je.UNKNOWN,"Fetching auth token failed: "+e.message);return this.z_(t)}))}))}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((t=>{n((()=>this.z_(t)))})),this.stream.onMessage((t=>{n((()=>1==++this.F_?this.J_(t):this.onNext(t)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return $e(Ma,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():($e(Ma,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Va extends Pa{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Qe(39313,{state:t})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(Xe(void 0===e||"string"==typeof e,58123),gr.fromBase64String(e||"")):(Xe(void 0===e||e instanceof Buffer||e instanceof Uint8Array,16193),gr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Je.UNKNOWN:Bs(t.code);return new Ze(e,t.message||"")}(o);n=new Xs(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=po(t,r.document.name),s=uo(r.document.updateTime),o=r.document.createTime?uo(r.document.createTime):Mn.min(),a=new ti({mapValue:{fields:r.document.fields}}),c=ni.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new Qs(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=po(t,r.document),s=r.readTime?uo(r.readTime):Mn.min(),o=ni.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Qs([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=po(t,r.document),s=r.removedTargetIds||[];n=new Qs([],s,i,null)}else{if(!("filter"in e))return Qe(11601,{Rt:e});{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new Vs(r,i),o=t.targetId;n=new Ws(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Mn.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Mn.min():e.readTime?uo(e.readTime):Mn.min()}(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=yo(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=xi(r)?{documents:bo(t,r)}:{query:Eo(t,r).ft},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=ao(t,e.resumeToken);const r=so(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(Mn.min())>0){n.readTime=oo(t,e.snapshotVersion.toTimestamp());const r=so(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qe(28987,{purpose:t})}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=yo(this.serializer),e.removeTarget=t,this.q_(e)}}class Fa extends Pa{constructor(t,e,n,r,i,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return Xe(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,Xe(!t.writeResults||0===t.writeResults.length,55816),this.listener.ta()}onNext(t){Xe(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=function(t,e){return t&&t.length>0?(Xe(void 0!==e,14353),t.map((t=>function(t,e){let n=t.updateTime?uo(t.updateTime):uo(e);return n.isEqual(Mn.min())&&(n=uo(e)),new ws(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=uo(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=yo(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof As)n={update:vo(t,e.key,e.value)};else if(e instanceof Rs)n={delete:mo(t,e.key)};else if(e instanceof xs)n={update:vo(t,e.key,e.data),updateMask:ko(e.fieldMask)};else{if(!(e instanceof Os))return Qe(16599,{Vt:e.type});n={verify:mo(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof us)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ls)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ds)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ms)return{fieldPath:e.field.canonicalString(),increment:n.Ae};throw Qe(20930,{transform:e.transform})}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:co(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Qe(27497)}(t,e.precondition)),n}(this.serializer,t)))};this.q_(e)}}class Ua{}class Ba extends Ua{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new Ze(Je.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Go(t,ho(e,n),r,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ze(Je.UNKNOWN,t.toString())}))}Ho(t,e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Ho(t,ho(e,n),r,s,o,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Je.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ze(Je.UNKNOWN,t.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class ja{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,"Online"===t&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ge(e),this.aa=!1):$e("OnlineStateTracker",e)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const qa="RemoteStore";class za{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((t=>{n.enqueueAndForget((async()=>{Ja(this)&&($e(qa,"Restarting streams for network reachability change."),await async function(t){const e=Ye(t);e.Ea.add(4),await Ga(e),e.Ra.set("Unknown"),e.Ea.delete(4),await $a(e)}(this))}))})),this.Ra=new ja(n,r)}}async function $a(t){if(Ja(t))for(const e of t.da)await e(!0)}async function Ga(t){for(const e of t.da)await e(!1)}function Ha(t,e){const n=Ye(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Ya(n)?Xa(n):gc(n).O_()&&Qa(n,e))}function Ka(t,e){const n=Ye(t),r=gc(n);n.Ia.delete(e),r.O_()&&Wa(n,e),0===n.Ia.size&&(r.O_()?r.L_():Ja(n)&&n.Ra.set("Unknown"))}function Qa(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Mn.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}gc(t).Y_(e)}function Wa(t,e){t.Va.Ue(e),gc(t).Z_(e)}function Xa(t){t.Va=new Js({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),gc(t).start(),t.Ra.ua()}function Ya(t){return Ja(t)&&!gc(t).x_()&&t.Ia.size>0}function Ja(t){return 0===Ye(t).Ea.size}function Za(t){t.Va=void 0}async function tc(t){t.Ra.set("Online")}async function ec(t){t.Ia.forEach(((e,n)=>{Qa(t,e)}))}async function nc(t,e){Za(t),Ya(t)?(t.Ra.ha(e),Xa(t)):t.Ra.set("Unknown")}async function rc(t,e,n){if(t.Ra.set("Online"),e instanceof Xs&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Ia.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Ia.delete(r),t.Va.removeTarget(r))}(t,e)}catch(n){$e(qa,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await ic(t,n)}else if(e instanceof Qs?t.Va.Ze(e):e instanceof Ws?t.Va.st(e):t.Va.tt(e),!n.isEqual(Mn.min()))try{const e=await pa(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Va.Tt(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.Ia.get(r);i&&t.Ia.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.Ia.get(e);if(!r)return;t.Ia.set(e,r.withResumeToken(gr.EMPTY_BYTE_STRING,r.snapshotVersion)),Wa(t,e);const i=new Ro(r.target,e,n,r.sequenceNumber);Qa(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){$e(qa,"Failed to raise snapshot:",e),await ic(t,e)}}async function ic(t,e,n){if(!qn(e))throw e;t.Ea.add(1),await Ga(t),t.Ra.set("Offline"),n||(n=()=>pa(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{$e(qa,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await $a(t)}))}function sc(t,e){return e().catch((n=>ic(t,n,e)))}async function oc(t){const e=Ye(t),n=yc(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;ac(e);)try{const t=await ga(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,cc(e,t)}catch(t){await ic(e,t)}uc(e)&&lc(e)}function ac(t){return Ja(t)&&t.Ta.length<10}function cc(t,e){t.Ta.push(e);const n=yc(t);n.O_()&&n.X_&&n.ea(e.mutations)}function uc(t){return Ja(t)&&!yc(t).x_()&&t.Ta.length>0}function lc(t){yc(t).start()}async function hc(t){yc(t).ra()}async function dc(t){const e=yc(t);for(const n of t.Ta)e.ea(n.mutations)}async function fc(t,e,n){const r=t.Ta.shift(),i=Ms.from(r,e,n);await sc(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await oc(t)}async function mc(t,e){e&&yc(t).X_&&await async function(t,e){if(function(t){return function(t){switch(t){case Je.OK:return Qe(64938);case Je.CANCELLED:case Je.UNKNOWN:case Je.DEADLINE_EXCEEDED:case Je.RESOURCE_EXHAUSTED:case Je.INTERNAL:case Je.UNAVAILABLE:case Je.UNAUTHENTICATED:return!1;case Je.INVALID_ARGUMENT:case Je.NOT_FOUND:case Je.ALREADY_EXISTS:case Je.PERMISSION_DENIED:case Je.FAILED_PRECONDITION:case Je.ABORTED:case Je.OUT_OF_RANGE:case Je.UNIMPLEMENTED:case Je.DATA_LOSS:return!0;default:return Qe(15467,{code:t})}}(t)&&t!==Je.ABORTED}(e.code)){const n=t.Ta.shift();yc(t).B_(),await sc(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await oc(t)}}(t,e),uc(t)&&lc(t)}async function pc(t,e){const n=Ye(t);n.asyncQueue.verifyOperationInProgress(),$e(qa,"RemoteStore received new credentials");const r=Ja(n);n.Ea.add(3),await Ga(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await $a(n)}function gc(t){return t.ma||(t.ma=function(t,e,n){const r=Ye(t);return r.sa(),new Va(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Xo:tc.bind(null,t),t_:ec.bind(null,t),r_:nc.bind(null,t),H_:rc.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),Ya(t)?Xa(t):t.Ra.set("Unknown")):(await t.ma.stop(),Za(t))}))),t.ma}function yc(t){return t.fa||(t.fa=function(t,e,n){const r=Ye(t);return r.sa(),new Fa(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:hc.bind(null,t),r_:mc.bind(null,t),ta:dc.bind(null,t),na:fc.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await oc(t)):(await t.fa.stop(),t.Ta.length>0&&($e(qa,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class wc{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new tn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new wc(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ze(Je.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function vc(t,e){if(Ge("AsyncQueue",`${e}: ${t}`),qn(t))return new Ze(Je.UNAVAILABLE,`${e}: ${t}`);throw t}class bc{static emptySet(t){return new bc(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||Tn.comparator(e.key,n.key):(t,e)=>Tn.comparator(t.key,e.key),this.keyedMap=Ki(),this.sortedSet=new ur(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof bc))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new bc;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Ec{constructor(){this.ga=new ur(Tn.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?0!==t.type&&3===n.type?this.ga=this.ga.insert(e,t):3===t.type&&1!==n.type?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ga=this.ga.remove(e):1===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):Qe(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,n)=>{t.push(n)})),t}}class _c{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new _c(t,e,bc.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Vi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Tc{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class Sc{constructor(){this.queries=Ic(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(t,e){const n=Ye(t),r=n.queries;n.queries=Ic(),r.forEach(((t,n)=>{for(const t of n.Sa)t.onError(e)}))}(this,new Ze(Je.ABORTED,"Firestore shutting down"))}}function Ic(){return new zi((t=>Fi(t)),Vi)}function Cc(t,e){const n=Ye(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.Sa)e.Fa(t)&&(r=!0);i.wa=t}}r&&xc(n)}function Ac(t,e,n){const r=Ye(t),i=r.queries.get(e);if(i)for(const t of i.Sa)t.onError(n);r.queries.delete(e)}function xc(t){t.Ca.forEach((t=>{t.next()}))}var Dc,kc;(kc=Dc||(Dc={})).Ma="default",kc.Cache="cache";class Nc{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new _c(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==e;return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ka(t){t=_c.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==Dc.Cache}}class Rc{constructor(t){this.key=t}}class Oc{constructor(t){this.key=t}}class Lc{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ts(),this.mutatedKeys=ts(),this.eu=ji(t),this.tu=new bc(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new Ec,r=e?e.tu:this.tu;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),l=Bi(this.query,e)?e:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.su(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.eu(l,a)>0||c&&this.eu(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{tu:s,iu:n,Cs:o,mutatedKeys:i}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const s=t.iu.ya();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qe(20277,{Rt:t})}};return n(t)-n(e)}(t.type,e.type)||this.eu(t.doc,e.doc))),this.ou(n),r=r??!1;const o=e&&!r?this._u():[],a=0===this.Xa.size&&this.current&&!r?1:0,c=a!==this.Za;return this.Za=a,0!==s.length||c?{snapshot:new _c(this.query,t.tu,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ec,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=ts(),this.tu.forEach((t=>{this.uu(t.key)&&(this.Xa=this.Xa.add(t.key))}));const e=[];return t.forEach((t=>{this.Xa.has(t)||e.push(new Oc(t))})),this.Xa.forEach((n=>{t.has(n)||e.push(new Rc(n))})),e}cu(t){this.Ya=t.Qs,this.Xa=ts();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return _c.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const Mc="SyncEngine";class Pc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Vc{constructor(t){this.key=t,this.hu=!1}}class Fc{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new zi((t=>Fi(t)),Vi),this.Iu=new Map,this.Eu=new Set,this.du=new ur(Tn.comparator),this.Au=new Map,this.Ru=new Zo,this.Vu={},this.mu=new Map,this.fu=jo.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function Uc(t,e,n=!0){const r=su(t);let i;const s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await jc(r,e,n,!0),i}async function Bc(t,e){const n=su(t);await jc(n,e,!0,!1)}async function jc(t,e,n,r){const i=await function(t,e){const n=Ye(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Pi.getTargetData(t,e).next((i=>i?(r=i,jn.resolve(r)):n.Pi.allocateTargetId(t).next((i=>(r=new Ro(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Pi.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.Ms.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(t.targetId,t),n.xs.set(e,t.targetId)),t}))}(t.localStore,Li(e)),s=i.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await async function(t,e,n,r,i){t.pu=(e,n,r)=>async function(t,e,n,r){let i=e.view.ru(n);i.Cs&&(i=await wa(t.localStore,e.query,!1).then((({documents:t})=>e.view.ru(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return Zc(t,e.targetId,a.au),a.snapshot}(t,e,n,r);const s=await wa(t.localStore,e,!0),o=new Lc(e,s.Qs),a=o.ru(s.documents),c=Ks.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(a,t.isPrimaryClient,c);Zc(t,n,u.au);const l=new Pc(e,n,o);return t.Tu.set(e,l),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),u.snapshot}(t,e,s,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&Ha(t.remoteStore,i),a}async function qc(t,e,n){const r=Ye(t),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter((t=>!Vi(t,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await ya(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Ka(r.remoteStore,i.targetId),Yc(r,i.targetId)})).catch(Bn)):(Yc(r,i.targetId),await ya(r.localStore,i.targetId,!0))}async function zc(t,e){const n=Ye(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Ka(n.remoteStore,r.targetId))}async function $c(t,e){const n=Ye(t);try{const t=await function(t,e){const n=Ye(t),r=e.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const o=[];e.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Pi.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.Pi.addMatchingKeys(t,s.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(gr.EMPTY_BYTE_STRING,Mn.min()).withLastLimboFreeSnapshotVersion(Mn.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Pi.updateTargetData(t,u))}));let a=Gi(),c=ts();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=ts(),i=ts();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Gi();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Mn.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):$e(da,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{ks:r,qs:i}}))}(t,s,e.documentUpdates).next((t=>{a=t.ks,c=t.qs}))),!r.isEqual(Mn.min())){const e=n.Pi.getLastRemoteSnapshotVersion(t).next((e=>n.Pi.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return jn.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.Ms=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Au.get(e);r&&(Xe(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?Xe(r.hu,14607):t.removedDocuments.size>0&&(Xe(r.hu,42227),r.hu=!1))})),await nu(n,t,e)}catch(t){await Bn(t)}}function Gc(t,e,n){const r=Ye(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.Tu.forEach(((n,r)=>{const i=r.view.va(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=Ye(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.Sa)t.va(e)&&(r=!0)})),r&&xc(n)}(r.eventManager,e),t.length&&r.Pu.H_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Hc(t,e,n){const r=Ye(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),s=i&&i.key;if(s){let t=new ur(Tn.comparator);t=t.insert(s,ni.newNoDocument(s,Mn.min()));const n=ts().add(s),i=new Hs(Mn.min(),new Map,new ur(dn),t,n);await $c(r,i),r.du=r.du.remove(s),r.Au.delete(e),eu(r)}else await ya(r.localStore,e,!1).then((()=>Yc(r,e,n))).catch(Bn)}async function Kc(t,e){const n=Ye(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Ye(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=jn.resolve();return s.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);Xe(null!==s,48541),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ts();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);Xc(n,r,null),Wc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await nu(n,t)}catch(t){await Bn(t)}}async function Qc(t,e,n){const r=Ye(t);try{const t=await function(t,e){const n=Ye(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Xe(null!==e,37113),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);Xc(r,e,n),Wc(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await nu(r,t)}catch(n){await Bn(n)}}function Wc(t,e){(t.mu.get(e)||[]).forEach((t=>{t.resolve()})),t.mu.delete(e)}function Xc(t,e,n){const r=Ye(t);let i=r.Vu[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Yc(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((e=>{t.Ru.containsKey(e)||Jc(t,e)}))}function Jc(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);null!==n&&(Ka(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),eu(t))}function Zc(t,e,n){for(const r of n)r instanceof Rc?(t.Ru.addReference(r.key,e),tu(t,r)):r instanceof Oc?($e(Mc,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||Jc(t,r.key)):Qe(19791,{wu:r})}function tu(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||($e(Mc,"New document in limbo: "+n),t.Eu.add(r),eu(t))}function eu(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Tn(bn.fromString(e)),r=t.fu.next();t.Au.set(r,new Vc(n)),t.du=t.du.insert(n,r),Ha(t.remoteStore,new Ro(Li(ki(n.path)),r,"TargetPurposeLimboResolution",zn.ce))}}async function nu(t,e,n){const r=Ye(t),i=[],s=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach(((t,a)=>{o.push(r.pu(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient){const e=t?!t.fromCache:n?.targetChanges.get(a.targetId)?.current;r.sharedClientState.updateQueryState(a.targetId,e?"current":"not-current")}if(t){i.push(t);const e=ua.As(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.Pu.H_(i),await async function(t,e){const n=Ye(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>jn.forEach(e,(e=>jn.forEach(e.Es,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>jn.forEach(e.ds,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!qn(t))throw t;$e(da,"Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ms.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(e,i)}}}(r.localStore,s))}async function ru(t,e){const n=Ye(t);if(!n.currentUser.isEqual(e)){$e(Mc,"User change. New user:",e.toKey());const t=await ma(n.localStore,e);n.currentUser=e,function(t){t.mu.forEach((t=>{t.forEach((t=>{t.reject(new Ze(Je.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.mu.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await nu(n,t.Ls)}}function iu(t,e){const n=Ye(t),r=n.Au.get(e);if(r&&r.hu)return ts().add(r.key);{let t=ts();const r=n.Iu.get(e);if(!r)return t;for(const e of r){const r=n.Tu.get(e);t=t.unionWith(r.view.nu)}return t}}function su(t){const e=Ye(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=$c.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=iu.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Hc.bind(null,e),e.Pu.H_=Cc.bind(null,e.eventManager),e.Pu.yu=Ac.bind(null,e.eventManager),e}function ou(t){const e=Ye(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Kc.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Qc.bind(null,e),e}class au{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Oa(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return function(t,e,n,r){return new fa(t,e,n,r)}(this.persistence,new ha,t.initialUser,this.serializer)}Cu(t){return new sa(aa.mi,this.serializer)}Du(t){return new ba}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}au.provider={build:()=>new au};class cu extends au{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){Xe(this.persistence.referenceDelegate instanceof ca,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Go(n,t.asyncQueue,e)}Cu(t){const e=void 0!==this.cacheSizeBytes?Bo.withCacheSize(this.cacheSizeBytes):Bo.DEFAULT;return new sa((t=>ca.mi(t,e)),this.serializer)}}class uu{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Gc(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=ru.bind(null,this.syncEngine),await async function(t,e){const n=Ye(t);e?(n.Ea.delete(2),await $a(n)):e||(n.Ea.add(2),await Ga(n),n.Ra.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Sc}createDatastore(t){const e=Oa(t.databaseInfo.databaseId),n=function(t){return new Na(t)}(t.databaseInfo);return function(t,e,n,r){return new Ba(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new za(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>Gc(this.syncEngine,t,0)),Ta.v()?new Ta:new Ea)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new Fc(t,e,n,r,i,s);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await async function(t){const e=Ye(t);$e(qa,"RemoteStore shutting down."),e.Ea.add(5),await Ga(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}uu.provider={build:()=>new uu};class lu{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Ge("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const hu="FirestoreClient";class du{constructor(t,e,n,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=Be.UNAUTHENTICATED,this.clientId=hn.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async t=>{$e(hu,"Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>($e(hu,"Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new tn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=vc(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function fu(t,e){t.asyncQueue.verifyOperationInProgress(),$e(hu,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await ma(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function mu(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){$e(hu,"Using user provided OfflineComponentProvider");try{await fu(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Je.FAILED_PRECONDITION||t.code===Je.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;He("Error using user provided cache. Falling back to memory cache: "+n),await fu(t,new au)}}else $e(hu,"Using default OfflineComponentProvider"),await fu(t,new cu(void 0));return t._offlineComponents}(t);$e(hu,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>pc(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>pc(e.remoteStore,n))),t._onlineComponents=e}async function pu(t){return t._onlineComponents||(t._uninitializedComponentsProvider?($e(hu,"Using user provided OnlineComponentProvider"),await mu(t,t._uninitializedComponentsProvider._online)):($e(hu,"Using default OnlineComponentProvider"),await mu(t,new uu))),t._onlineComponents}async function gu(t){const e=await pu(t),n=e.eventManager;return n.onListen=Uc.bind(null,e.syncEngine),n.onUnlisten=qc.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Bc.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=zc.bind(null,e.syncEngine),n}function yu(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const wu=new Map,vu="firestore.googleapis.com",bu=!0;class Eu{constructor(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Ze(Je.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=vu,this.ssl=bu}else this.host=t.host,this.ssl=t.ssl??bu;if(this.isUsingEmulator=void 0!==t.emulatorOptions,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=Uo;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ze(Je.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Ze(Je.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yu(t.experimentalLongPollingOptions??{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Ze(Je.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Ze(Je.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Ze(Je.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class _u{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Eu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ze(Je.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Ze(Je.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Eu(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new nn;switch(t.type){case"firstParty":return new an(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Ze(Je.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=wu.get(t);e&&($e("ComponentProvider","Removing Datastore"),wu.delete(t),e.terminate())}(this),Promise.resolve()}}class Tu{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Tu(this.firestore,t,this._query)}}class Su{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Iu(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Su(this.firestore,t,this._key)}toJSON(){return{type:Su._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(Nn(e,Su._jsonSchema))return new Su(t,n||null,new Tn(bn.fromString(e.referencePath)))}}Su._jsonSchemaVersion="firestore/documentReference/1.0",Su._jsonSchema={type:kn("string",Su._jsonSchemaVersion),referencePath:kn("string")};class Iu extends Tu{constructor(t,e,n){super(t,e,ki(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Su(this.firestore,null,new Tn(t))}withConverter(t){return new Iu(this.firestore,t,this._path)}}const Cu="AsyncQueue";class Au{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new La(this,"async_queue_retry"),this._c=()=>{const t=Ra();t&&$e(Cu,"Visibility state changed to "+t.visibilityState),this.M_.w_()},this.ac=t;const e=Ra();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Ra();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new tn;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!qn(t))throw t;$e(Cu,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((t=>{throw this.nc=t,this.rc=!1,Ge("INTERNAL UNHANDLED ERROR: ",xu(t)),t})).then((t=>(this.rc=!1,t))))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const r=wc.createAndSchedule(this,t,e,n,(t=>this.hc(t)));return this.tc.push(r),r}uc(){this.nc&&Qe(47125,{Pc:xu(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do{t=this.ac,await t}while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function xu(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}function Du(t){return function(t){if("object"!=typeof t||null===t)return!1;const e=t;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(t)}class ku extends _u{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Au,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Au(t),this._firestoreClient=void 0,await t}}}function Nu(t){if(t._terminated)throw new Ze(Je.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||function(t){const e=t._freezeSettings(),n=function(t,e,n,r){return new xr(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,yu(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new du(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(t){const e=t?._online.build();return{_offline:t?._offline.build(e),_online:e}}(t._componentsProvider))}(t),t._firestoreClient}class Ru{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ru(gr.fromBase64String(t))}catch(t){throw new Ze(Je.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Ru(gr.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Ru._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Nn(t,Ru._jsonSchema))return Ru.fromBase64String(t.bytes)}}Ru._jsonSchemaVersion="firestore/bytes/1.0",Ru._jsonSchema={type:kn("string",Ru._jsonSchemaVersion),bytes:kn("string")};class Ou{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Ze(Je.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _n(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Lu{constructor(t){this._methodName=t}}class Mu{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ze(Je.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ze(Je.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return dn(this._lat,t._lat)||dn(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Mu._jsonSchemaVersion}}static fromJSON(t){if(Nn(t,Mu._jsonSchema))return new Mu(t.latitude,t.longitude)}}Mu._jsonSchemaVersion="firestore/geoPoint/1.0",Mu._jsonSchema={type:kn("string",Mu._jsonSchemaVersion),latitude:kn("number"),longitude:kn("number")};class Pu{constructor(t){this._values=(t||[]).map((t=>t))}toArray(){return this._values.map((t=>t))}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}toJSON(){return{type:Pu._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Nn(t,Pu._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((t=>"number"==typeof t)))return new Pu(t.vectorValues);throw new Ze(Je.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Pu._jsonSchemaVersion="firestore/vectorValue/1.0",Pu._jsonSchema={type:kn("string",Pu._jsonSchemaVersion),vectorValues:kn("object")};const Vu=/^__.*__$/;class Fu{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new xs(t,this.data,this.fieldMask,e,this.fieldTransforms):new As(t,this.data,e,this.fieldTransforms)}}function Uu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qe(40011,{Ac:t})}}class Bu{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new Bu({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.gc(t),n}yc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.Rc(),n}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Ju(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(0===t.length)throw this.Sc("Document fields must not be empty");if(Uu(this.Ac)&&Vu.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class ju{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Oa(t)}Cc(t,e,n,r=!1){return new Bu({Ac:t,methodName:e,Dc:n,path:_n.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function qu(t){const e=t._freezeSettings(),n=Oa(t._databaseId);return new ju(t._databaseId,!!e.ignoreUndefinedProperties,n)}function zu(t,e,n,r,i,s={}){const o=t.Cc(s.merge||s.mergeFields?2:0,e,n,i);Qu("Data must be an object, but it was:",o,r);const a=Hu(r,o);let c,u;if(s.merge)c=new mr(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=Wu(e,r,n);if(!o.contains(i))throw new Ze(Je.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Zu(t,i)||t.push(i)}c=new mr(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new Fu(new ti(a),c,u)}class $u extends Lu{_toFieldTransform(t){return new ys(t.path,new us)}isEqual(t){return t instanceof $u}}function Gu(t,e){if(Ku(t=tt(t)))return Qu("Unsupported field value:",e,t),Hu(t,e);if(t instanceof Lu)return function(t,e){if(!Uu(e.Ac))throw e.Sc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Sc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&4!==e.Ac)throw e.Sc("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=Gu(i,e.wc(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=tt(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return is(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ln.fromDate(t);return{timestampValue:oo(e.serializer,n)}}if(t instanceof Ln){const n=new Ln(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:oo(e.serializer,n)}}if(t instanceof Mu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ru)return{bytesValue:ao(e.serializer,t._byteString)};if(t instanceof Su){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:lo(t.firestore._databaseId||e.databaseId,t._key.path)}}if(t instanceof Pu)return function(t,e){return{mapValue:{fields:{[Nr]:{stringValue:Lr},[Mr]:{arrayValue:{values:t.toArray().map((t=>{if("number"!=typeof t)throw e.Sc("VectorValues must only contain numeric values.");return ns(e.serializer,t)}))}}}}}}(t,e);throw e.Sc(`Unsupported field value: ${xn(t)}`)}(t,e)}function Hu(t,e){const n={};return cr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ar(t,((t,r)=>{const i=Gu(r,e.mc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Ku(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ln||t instanceof Mu||t instanceof Ru||t instanceof Su||t instanceof Lu||t instanceof Pu)}function Qu(t,e,n){if(!Ku(n)||!An(n)){const r=xn(n);throw"an object"===r?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Wu(t,e,n){if((e=tt(e))instanceof Ou)return e._internalPath;if("string"==typeof e)return Yu(t,e);throw Ju("Field path arguments must be of type string or ",t,!1,void 0,n)}const Xu=new RegExp("[~\\*/\\[\\]]");function Yu(t,e,n){if(e.search(Xu)>=0)throw Ju(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Ou(...e.split("."))._internalPath}catch(r){throw Ju(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ju(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Ze(Je.INVALID_ARGUMENT,a+t+c)}function Zu(t,e){return t.some((t=>t.isEqual(e)))}class tl{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Su(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new el(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(nl("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class el extends tl{data(){return super.data()}}function nl(t,e){return"string"==typeof e?Yu(t,e):e instanceof Ou?e._internalPath:e._delegate._internalPath}class rl{}class il extends rl{}class sl extends il{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new sl(t,e,n)}_apply(t){const e=this._parse(t);return ul(t._query,e),new Tu(t.firestore,t.converter,Mi(t._query,e))}_parse(t){const e=qu(t.firestore),n=function(t,e,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Ze(Je.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){cl(o,s);const e=[];for(const n of o)e.push(al(r,t,n));a={arrayValue:{values:e}}}else a=al(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||cl(o,s),a=function(t,e,n,r=!1){return Gu(n,t.Cc(r?4:3,e))}(n,"where",o,"in"===s||"not-in"===s);return ui.create(i,s,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}class ol extends rl{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new ol(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:li.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const t of r)ul(n,t),n=Mi(n,t)}(t._query,e),new Tu(t.firestore,t.converter,Mi(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function al(t,e,n){if("string"==typeof(n=tt(n))){if(""===n)throw new Ze(Je.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ri(e)&&-1!==n.indexOf("/"))throw new Ze(Je.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(bn.fromString(n));if(!Tn.isDocumentKey(r))throw new Ze(Je.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Gr(t,new Tn(r))}if(n instanceof Su)return Gr(t,n._key);throw new Ze(Je.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xn(n)}.`)}function cl(t,e){if(!Array.isArray(t)||0===t.length)throw new Ze(Je.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ul(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Ze(Je.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ze(Je.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class ll{convertValue(t,e="none"){switch(Pr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return vr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(br(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw Qe(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return ar(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertVectorValue(t){const e=t.fields?.[Mr].arrayValue?.values?.map((t=>vr(t.doubleValue)));return new Pu(e)}convertGeoPoint(t){return new Mu(vr(t.latitude),vr(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Cr(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ar(t));default:return null}}convertTimestamp(t){const e=wr(t);return new Ln(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=bn.fromString(t);Xe(No(n),9688,{name:t});const r=new kr(n.get(1),n.get(3)),i=new Tn(n.popFirst(5));return r.isEqual(e)||Ge(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class hl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class dl extends tl{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new fl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(nl("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Ze(Je.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=dl._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),t&&t.isValidDocument()&&t.isFoundDocument()?(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e):e}}dl._jsonSchemaVersion="firestore/documentSnapshot/1.0",dl._jsonSchema={type:kn("string",dl._jsonSchemaVersion),bundleSource:kn("string","DocumentSnapshot"),bundleName:kn("string"),bundle:kn("string")};class fl extends dl{data(t={}){return super.data(t)}}class ml{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new hl(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new fl(this._firestore,this._userDataWriter,n.key,n,new hl(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Ze(Je.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new fl(t._firestore,t._userDataWriter,n.doc.key,n.doc,new hl(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new fl(t._firestore,t._userDataWriter,e.doc.key,e.doc,new hl(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:pl(e.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Ze(Je.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=ml._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=hn.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],r=[];return this.docs.forEach((t=>{null!==t._document&&(e.push(t._document),n.push(this._userDataWriter.convertObjectMap(t._document.data.value.mapValue.fields,"previous")),r.push(t.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function pl(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Qe(61501,{type:t})}}ml._jsonSchemaVersion="firestore/querySnapshot/1.0",ml._jsonSchema={type:kn("string",ml._jsonSchemaVersion),bundleSource:kn("string","QuerySnapshot"),bundleName:kn("string"),bundle:kn("string")};class gl extends ll{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ru(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Su(this.firestore,null,e)}}function yl(t,e){const n=Dn(t.firestore,ku),r=function(t,e,...n){if(t=tt(t),1===arguments.length&&(e=hn.newId()),Sn("doc","path",e),t instanceof _u){const r=bn.fromString(e,...n);return In(r),new Su(t,null,new Tn(r))}{if(!(t instanceof Su||t instanceof Iu))throw new Ze(Je.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(bn.fromString(e,...n));return In(r),new Su(t.firestore,t instanceof Iu?t.converter:null,new Tn(r))}}(t),i=function(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}(t.converter,e);return function(t,e){return function(t,e){const n=new tn;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=ou(t);try{const t=await function(t,e){const n=Ye(t),r=Ln.now(),i=e.reduce(((t,e)=>t.add(e.key)),ts());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Gi(),c=ts();return n.Ns.getEntries(t,i).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((i=>{s=i;const o=[];for(const t of e){const e=Is(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new xs(t.key,e,ei(e.value.mapValue),vs.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Qi(s)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Vu[t.currentUser.toKey()];r||(r=new ur(dn)),r=r.insert(e,n),t.Vu[t.currentUser.toKey()]=r}(r,t.batchId,n),await nu(r,t.changes),await oc(r.remoteStore)}catch(t){const e=vc(t,"Failed to persist write");n.reject(e)}}(await function(t){return pu(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(Nu(t),e)}(n,[zu(qu(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,vs.exists(!1))]).then((()=>r))}new WeakMap,function(t,e=!0){je="12.4.0",le(new et("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new ku(new sn(t.getProvider("auth-internal")),new un(i,t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ze(Je.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new kr(t.options.projectId,e)}(i,n),i);return r={useFetchStreams:e,...r},s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),me(Fe,Ue,t),me(Fe,Ue,"esm2020")}();const wl=document.querySelector("#email-feedback"),vl=document.querySelector("form#waitlistForm"),bl=vl.querySelector("input");vl.addEventListener("submit",(t=>{t.preventDefault()})),bl.addEventListener("input",(function(){_l(this.value)}));let El=!1;const _l=t=>{El=!1;""==t?Tl({element:wl,message:"Please enter a valid email"}):/^.*@.*$/.test(t)?/@[^@]+\.[a-z]{2,}$/.test(t)?/^\S+$/.test(t)?/^[\w.!#$%&'*+/=?^`{|}~-]+@[a-z\d-]+(?:\.[a-z\d-]+)*$/i.test(t)&&(Tl({element:wl}),El=!0):Tl({element:wl,message:"Email must not contain spaces"}):Tl({element:wl,message:"Email must end with a valid domain e.g .com,.org"}):Tl({element:wl,message:"Email must contain the @ symbol"})},Tl=({element:t,message:e=""})=>{t.textContent=e},Sl=t=>{vl.querySelector("button").innerHTML=t?'\n  <svg class="spinner" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 50 50">\n    <circle cx="25" cy="25" r="20" stroke="#fff" stroke-width="5" fill="none" stroke-linecap="round"/>\n  </svg>\n':"Join Now"};document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("mobile-menu-button"),e=document.getElementById("mobile-menu");t.addEventListener("click",(()=>{e.classList.toggle("active"),t.setAttribute("aria-expanded",String(e.classList.contains("active")))})),document.querySelectorAll("#mobile-menu a").forEach((n=>{n.addEventListener("click",(()=>{e.classList.remove("active"),t.setAttribute("aria-expanded","false")}))}))}));const Il=t=>{const e=document.querySelector(".success"),n=document.querySelector(".error");t?(e.style.display="block",n.style.display="none"):(n.style.display="block",e.style.display="none")},Cl=function(t,e,...n){if(t=tt(t),Sn("collection","path",e),t instanceof _u){const r=bn.fromString(e,...n);return Cn(r),new Iu(t,null,r)}{if(!(t instanceof Su||t instanceof Iu))throw new Ze(Je.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(bn.fromString(e,...n));return Cn(r),new Iu(t.firestore,null,r)}}(function(t){const e="object"==typeof t?t:function(t=ie){const e=oe.get(t);if(!e&&t===ie&&q())return fe();if(!e)throw he.create("no-app",{appName:t});return e}(),n="string"==typeof t?t:Dr,r=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}(e,"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(t=>{const e=(t=>j()?.emulatorHosts?.[t])(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){t=Dn(t,_u);const i=$(e),s=t._getSettings(),o={...s,emulatorOptions:t._getEmulatorOptions()},a=`${e}:${n}`;i&&(async function(t){(await fetch(t,{credentials:"include"})).ok}(`https://${a}`),K("Firestore",!0)),s.host!==vu&&s.host!==a&&He("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...s,host:a,ssl:i,emulatorOptions:r};if(!J(c,o)&&(t._setSettings(c),r.mockUserToken)){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Be.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[B(JSON.stringify({alg:"none",type:"JWT"})),B(JSON.stringify(s)),""].join(".")}(r.mockUserToken,t._app?.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Ze(Je.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Be(i)}t._authCredentials=new rn(new en(e,n))}}(r,...t)}return r}(fe({apiKey:"AIzaSyBVEAyXVAiM5NPL2bdbegZdIUYROZQJ-YE",authDomain:"case-be-heard-website.firebaseapp.com",projectId:"case-be-heard-website",storageBucket:"case-be-heard-website.firebasestorage.app",messagingSenderId:"765706349267",appId:"1:765706349267:web:5d5d15965005748f160226",measurementId:"G-7G9PN4QGWY"})),"waitlist");vl.addEventListener("submit",(async()=>{El&&await async function(t){Sl(!0);try{await yl(Cl,{email:t,timestamp:new $u("serverTimestamp")}),console.log("Successfully added to waitlist!"),Il(!0)}catch(t){console.error("Error adding to waitlist: ",t),Il(!1)}finally{Sl(!1)}}(bl.value.trim())})),function(t,...e){t=tt(t);let n={includeMetadataChanges:!1,source:"default"},r=0;"object"!=typeof e[r]||Du(e[r])||(n=e[r++]);const i={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(Du(e[r])){const t=e[r];e[r]=t.next?.bind(t),e[r+1]=t.error?.bind(t),e[r+2]=t.complete?.bind(t)}let s,o,a;if(t instanceof Su)o=Dn(t.firestore,ku),a=ki(t._key.path),s={next:n=>{e[r]&&e[r](function(t,e,n){const r=n.docs.get(e._key),i=new gl(t);return new dl(t,i,e._key,r,new hl(n.hasPendingWrites,n.fromCache),e.converter)}(o,t,n))},error:e[r+1],complete:e[r+2]};else{const n=Dn(t,Tu);o=Dn(n.firestore,ku),a=n._query;const i=new gl(o);s={next:t=>{e[r]&&e[r](new ml(o,i,n,t))},error:e[r+1],complete:e[r+2]},function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Ze(Je.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query)}(function(t,e,n,r){const i=new lu(r),s=new Nc(e,i,n);t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=Ye(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.ba()&&e.Da()&&(r=2):(s=new Tc,r=e.Da()?0:1);try{switch(r){case 0:s.wa=await n.onListen(i,!0);break;case 1:s.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=vc(t,`Initialization of query '${Ui(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.Sa.push(e),e.va(n.onlineState),s.wa&&e.Fa(s.wa)&&xc(n)}(await gu(t),s)))})(Nu(o),a,i,s)}(function(t,e,...n){let r=[];e instanceof rl&&r.push(e),r=r.concat(n),function(t){const e=t.filter((t=>t instanceof ol)).length,n=t.filter((t=>t instanceof sl)).length;if(e>1||e>0&&n>0)throw new Ze(Je.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const e of r)t=e._apply(t);return t}(Cl),(t=>{const e=t.size;document.getElementById("waitlistCount").innerText=e,console.log("Live waitlist count:",e)}))})();